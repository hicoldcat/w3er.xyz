---
title: 什么是双花问题？
description: null
author: 李留白
weight: 0
date: 2022-09-20T13:56:06.564Z
lastmod: 2022-09-20T14:56:30.995Z
tags: []
categories:
  - 区块链
featuredImage: https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/20220920212931.png
draft: true
---

双花问题（或者叫双重消费问题）是创建比特币和加密货币的核心。

但它到底是什么？

## 什么是双花问题？

双花问题是指资金可能被使用超过一次的风险；因此，被称为“双花(double spend)”。

数字货币特别容易受到这种风险的影响，因为同一单位被使用超过一次的情况不太清楚。

对于实物现金，你可以凭经验判断一张纸币或硬币何时被用过，所以不需要担心双重消费。

任何玩过视频游戏的人都知道有人声称他们可以在没有足够余额的情况下无限地花费游戏中的硬币。如果他们没有说谎，这可能是双倍消费的漏洞造成的。

用户可能发送两个Roblox交易来使用相同的硬币，而系统没有注意到这一点。交易完成后，用户的消费能力实际上增加了一倍。

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/giphy.gif)



### 为什么这是个问题？

不言而喻，利用数字货币进行双倍消费的人就是在偷窃市场。这不仅对其他使用相同货币的人不公平，而且可能导致数字货币的价格波动--双重消费类似于印刷更多的代币，使货币通货膨胀。

如果一个网络成为双重消费攻击的受害者，数字货币的安全性就会受到质疑。而且，在修复双重消费造成的问题时，你可能会让某人为他们已经提供的服务得不到报酬。

所以，是的，这只是不理想。

## 加密货币是如何解决双重消费问题的？

比特币的诞生解决了数字货币的双重消费问题。比特币的创始人中本聪甚至在比特币白皮书中说，它是一个解决双重消费问题的建议。

当一笔交易被发送到网络时，它位于一个未经确认的交易池中，直到网络准备好处理它。

每 10 分钟，就会从该池中提取交易以进行处理——这将形成所谓的“块”。这些区块充当比特币上所有交易的永久记录。例如，此区块将显示 Paul 发送了 Sally 1 BTC，这会影响他们两个钱包的余额。

由于所有区块都记录在区块链上，因此每个人的交易历史都是可追溯的。当一个交易被处理时，它会通过这些记录的数据来参考你的钱包，以确保你有你试图花费的钱。

由于比特币是一个分布式账本，这意味着所有这些数据（包括交易历史、钱包余额等）都存储在世界各地的成千上万个节点上。这确保了比特币是去中心化的，减少了有人直接改变这些数据的风险。

这就消除了重复花费的问题；如果你要花费同一个比特币两次，网络会与区块链上的数据进行检查，发现你的钱包余额不足。在这种情况下，一个或两个交易将无法处理。

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/giphy (1).gif)

### 网络如何快速注意到账本的变化？

当一个区块被成功开采后，它会被存储为一个称为哈希的加密数字（比特币使用[SHA-256 算法](https://www.movable-type.co.uk/scripts/sha256.html)）。这个哈希将包括前一个区块的信息、时间戳和交易细节。

由于[雪崩效应](https://www.cryptovision.com/en/glossary/avalanche-effect/#:~:text=The Avalanche Effect refers to,show a strong avalanche effect.)，即使对原始数据的任何部分进行微小的更改，也会导致完全不同的哈希值。这使得网络很容易注意到区块链上数据的任何变化。

## 双花问题将如何发生？

尽管现在不太可能出现双重支出，但仍有可能。有（至少）四种可能的攻击可能导致双花攻击。

### 赛跑攻击

赛跑（或者叫竞争）攻击是指同时广播两笔交易（一笔发送给提供商品或服务的商家，另一笔发送给攻击者控制的单独钱包）。为了使攻击成功，对攻击者自己钱包的付款必须先被处理。

攻击者可以通过增加燃气费来增加第二笔交易被更快处理的机会，这将激励矿工首先挖掘该交易。

如果攻击成功，支付给攻击者钱包的款项将首先被挖出，而支付给商家的交易将被废止，因为钱包里没有钱。



![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/giphy (2).gif)



#### 为什么这不太可能

这要求商家在交易被验证之前提供商品或服务；大多数地方不会这样做，以保护自己免受此类攻击。

### 芬尼攻击

[Hal Finney](https://www.forbes.com/sites/andygreenberg/2014/03/25/satoshi-nakamotos-neighbor-the-bitcoin-ghostwriter-who-wasnt/?sh=4ed117a44a37)是最早的比特币贡献者之一；他实际上是第一个从中本聪本人那里收到硬币的人！Finney 推测，双重花费攻击可能在三个步骤之后发生：

第一步是攻击者将交易发送到他们已经控制的地址。该交易将开始在他们负责的区块中（作为矿工）进行开采。

接下来，攻击者会将交易包含在区块中，但不会将其广播到区块链。相反，他们会向商家提交商品或服务的交易。

最后，一旦商家接受付款并提供商品或服务（无需等待其在区块链上验证），攻击者会将原始付款广播到区块链。这将使与商家的交易无效，并在他们自己的钱包中验证交易。

#### 为什么这不太可能

这不仅需要商家在交易被验证之前向你提供商品或服务，而且还需要攻击者在开始攻击之前知道他们将成为区块的矿工（这将需要非常高的算力的数量）。

### 51% 攻击

[51% 攻击](https://web3.hashnode.com/what-is-a-51-attack)是指个人、团体或实体控制了区块链 51% 的哈希算力。凭借这种级别的哈希能力，他们可以比任何其他矿工更快地挖掘，从而创建网络上最长的链。

当有两条冲突的链时，工作量证明会选择最长的链，这意味着 51% 的攻击者将拥有操纵网络的权力。

为了双重消费，51%的攻击者将在公共网络上花费他们的硬币（通常是不能撤销的真实世界资产），同时将这些交易从他们自己的链上排除。他们通常会私下里做一段时间，以确保他们有最长的链，然后再广播到区块链上。

> 有关 51% 攻击的更多信息，请查看[我们的文章详细解释](https://web3.hashnode.com/what-is-a-51-attack)。

#### 为什么这不太可能

对于像比特币这样的大型工作证明网络来说，51% 的攻击不太可能发生。这是因为为了获得 51% 的算力，你需要[花费超过 150 亿美元](https://www.bitpanda.com/academy/en/lessons/what-is-a-51-attack-and-how-is-it-prevented/)……我们可能还好。

权益证明区块链也不太可能，因为网络中的验证者需要质押他们自己的代币，如果他们是坏人，这些代币将被拿走。

### 替代交易历史攻击

攻击者将向商家提交交易，同时私下挖掘他们自己的区块链版本，添加一个将资金发送回攻击者的交易。

如果攻击者在商家发送商品或服务所花费的时间内挖掘出更多的区块，攻击者可以将其广播到网络，并使对商家的原始付款无效。

#### 为什么这不太可能

与 51% 攻击类似，这将需要惊人的散列能力。但同样，它在理论上仍然是可能的。

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/giphy (3).gif)

## 比特币曾经发生过双重支出吗？

事实上，没有! 没有记录显示有成功的双重消费攻击的证据。许多人认为这是加密货币已经解决了双重消费问题的证据。

双重消费攻击是可能的，但不太可能发生在最大的网络上。

## 结论

双花问题一直是困扰数字货币未来的一个问题，直到中本聪出现并创造了一种叫做比特币的古老事物。通过创建一个永久记录所有交易数据并使用 SHA-256 哈希对其进行加密的分布式账本，这种演变似乎解决了双花问题。

话虽如此，理论上攻击仍然是可能的。但是，它们都需要商家一方的疏忽或深不可测的散列能力。
