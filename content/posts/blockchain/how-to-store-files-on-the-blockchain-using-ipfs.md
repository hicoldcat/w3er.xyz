---
title: 如何使用 IPFS 在区块链上存储文件？
description: null
author: 李留白
weight: 0
date: 2022-09-29T13:07:36.326Z
lastmod: 2022-09-29T13:15:43.750Z
tags: []
categories:
  - 区块链
featuredImage: https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/20220929210755.png
---

> 了解图像和文档等数据如何存储在去中心化存储中

在本系列中，我们将讨论在区块链上存储文件文档的**链上**和**链下**方法。

稍后，我们将学习如何使用由[Moralis](https://moralis.io/)和[Infura IPFS](https://infura.io/)提供支持的星际文件系统 (IPFS) 网络在链下存储图像、PDF 或任何其他数字资产等文件。

在本教程系列结束时，您将能够在 IPFS 网络上存储和访问文件。

## 区块链作为数据库

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/20220929210944.png)

作为数据库，区块链是一个不可变的数字交易账本，分布在多个计算机网络上。它使我们能够存储数据，即[NFT 元数据](https://docs.opensea.io/docs/metadata-standards)（包括文件），并以与任何其他数据库相同的方式检索它们。

## 在区块链上存储文件（链上）

链上是指直接在区块链上发生的经过验证的活动或交易。在这种情况下，将文件直接上传到区块链也是一种链上活动。

但是，我们应该直接在链上存储文件吗？将文件保存在链上是个好主意吗？区块链存储成本是多少？

### 在区块链上存储文件的成本（链上）

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/20220929211036.png)

在区块链上存储大文件的成本可能非常昂贵。[根据 IBM第 9 页](https://www.ibm.com/downloads/cas/LA8XBQGR)的“区块链技术的存储需求 - 观点文档” ，1GB 的存储在区块链上的成本约为 100 美元，比传统存储贵 500 倍。

### 区块链（On-Chain）文件存储性能

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/20220929211049.png)

除了昂贵之外，在区块链上存储大量文件会增加文件的[访问延迟](https://www.igi-global.com/dictionary/access-latency/267)（增加从区块链上传/下载文件所需的时间）。

文件存储需要低延迟才能快速访问。但是，当文件过重导致延迟增加时，这可能会降低区块链系统的性能，并使维护变得非常困难。

不建议将文件、合同、文档、PDF 和个人信息等非交易数据直接存储在区块链上，但您应该考虑将它们存储在链下。

## 将文件存储在区块链之外（链下）

术语“链下”是指发生在区块链之外的活动或交易。在这种情况下，链下资产是不直接上传到区块链上的文件。

由于不建议存储非交易数据，因此文件被上传到另一个服务器或数据库（IPFS、MongoDB、Oracle 等），为上传的文件生成的 HashID 将作为元数据存储在区块链上。

## 什么是 IPFS？

> Web3 数据库🤯

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/20220929211106.png)

星际**文件系统（IPFS）**是一个去中心化的存储系统。一种协议和点对点 (p2p) 网络，用于在区块链等分布式文件系统中存储、访问和共享数据。

IPFS 基于基于内容的身份 (CID) 或基于内容的寻址，其创建速度比保存文件的传统基于位置的寻址方法更快。

### 什么是基于位置的寻址？

> HTTP：“哪里”是你想要的内容🤷‍♂️

基于位置的寻址是访问 Internet 上的照片、音乐和文件等内容的传统方法，它需要通过提供内容的绝对路径或地址来指定内容的托管位置，如下所示：

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/20220929211120.png)

基于位置的寻址的局限性在于它使用集中式服务器，如果托管它们的服务器出现故障，则内容将不可用。

在 Twitter 和 Facebook 等集中式服务器中，它们独立控制用户保存的内容的传递方式（即 URL），您只能通过 Twitter URL 而不是 Facebook URL 访问 Twitter 个人资料图像。

### 什么是基于内容的寻址？

> IPFS：你想要“什么”内容🤔

在基于内容的寻址或内容寻址存储 (CAS) 中，每个上传的内容都有自己的唯一标识符，称为**Hash**，可以将其与指纹进行比较，并且没有两个内容可以共享相同的哈希。

照片、音乐和文件等内容可以通过其唯一的 IPFS 哈希而不是它们的位置来访问。

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/20220929211132.png)

任何上传到 IPFS 的内容都可以通过支持的 IPFS 公共网关访问。例如，当通过 Moralis IPFS 上传文件时，我们可以使用 Infura IPFS URL 访问文件。

上传的内容存储在一个 IPFS 对象中，该对象是一个具有两个字段的数据结构，一个**数据**可以容纳最多 256 KB 的 blob 数据，另一个是**links**，它是指向其他 IPFS 对象的链接数组。

```
/* IPFS Object Example */

{
   Data: "",
   Links: [
      {
         Name: “”,  
         Hash: “”,
         Size: 256000
      }
   ]
}
```

当内容大小超过 256kb 时，IPFS 会自动将其分解为多个对象并创建一个空 IPFS 以将所有哈希链接在一起。

存储在 IPFS 上的内容不能像在区块链上那样更改。相反，IPFS 支持您的内容的版本控制，称为 IPFS 提交对象，它连接到以前的版本对象。

> IPFS 最初由 Protocol Labs 的创始人 Juan Benet 于 2015 年 2 月创建。

### IPFS 数据存储在哪里？

> 缓存文件夹🗂

存储在 IPFS 上的数据保存在本地计算机的缓存文件夹中，并提供给通过 IPFS 网关请求它的其他人。数据也缓存在新用户的计算机上。

缓存的数据在垃圾收集期间被丢弃，这可能导致数据丢失。为了将您的数据永久保存在 IPFS 上，您需要将其固定到 IPFS 网络之一。

### IPFS 的优势是什么？

1. 快速记录检索。
2. 它适用于所有技术。
3. 只能存储单个内容实例（不能重复）。
4. 上传的内容具有唯一标识符是真实的。
5. 上传的内容不能更改。

### IPFS 和 HTTP 存储之间的区别

| IPFS（基于内容的寻址）                 | HTTP（基于位置的寻址）               |
| -------------------------------------- | ------------------------------------ |
| 它基于分散的服务器                     | 它基于一个集中的源服务器             |
| 它利用内容寻址                         | 它利用位置寻址                       |
| 具有相同内容的所有对象只存储一次       | 所有具有相同内容的对象都可以存储多次 |
| 文件在多个节点之间共享并且始终可以访问 | 服务器关闭时无法访问文件             |
| 它有很大的市场                         | 它的市场低                           |
| 不可变（版本控制）                     | 可变的                               |

## 总结

星际文件系统（IPFS）是一种可靠的去中心化存储系统。它也被广泛认为是文件存储的未来。

在本文中，我们了解了 HTTP 和 IPFS 存储之间的区别，以及在区块链上存储文件的链上和链下(IPFS)方法。

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/my.png)
