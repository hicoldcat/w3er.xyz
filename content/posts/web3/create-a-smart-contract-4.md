---
title: Web3æ•™ç¨‹ï¼šç¼–å†™æ‚¨çš„ç¬¬ä¸€ä¸ªâ€œHello, Worldâ€æ™ºèƒ½åˆçº¦ï¼ˆ4ï¼‰
description: null
author: æç•™ç™½
weight: 0
date: 2022-10-30T03:48:39.211Z
lastmod: 2022-10-30T03:48:44.723Z
tags: []
categories:
  - åŒºå—é“¾
  - WEB3.0
featuredImage: https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/202210271827013.png
---

ä¸Šä¸€ç¯‡ä¼ é€é—¨ï¼š[Web3æ•™ç¨‹ï¼šç¼–å†™æ‚¨çš„ç¬¬ä¸€ä¸ªâ€œHello, Worldâ€æ™ºèƒ½åˆçº¦ï¼ˆ3ï¼‰](https://mp.weixin.qq.com/s/_tSlbHkeG70IJgT9L9fm7Q)

## ç›®å½•

1. ä»€ä¹ˆæ˜¯æ™ºèƒ½åˆçº¦
2. éƒ¨ç½²æ‚¨çš„ç¬¬ä¸€ä¸ªæ™ºèƒ½åˆçº¦
3. ä»€ä¹ˆæ˜¯æ°”ä½“
4. ä¸æ‚¨çš„æ™ºèƒ½åˆçº¦äº¤äº’
5. æ™ºèƒ½åˆçº¦çš„ç»“æ„
6. å°†æ‚¨çš„åˆåŒæäº¤ç»™ Etherscan
7. æ™ºèƒ½åˆçº¦å®‰å…¨æŒ‘æˆ˜
8. å°†åˆçº¦é›†æˆåˆ°å‰ç«¯
9. å…¶ä»–èµ„æº

## 8ã€å°†æ‚¨çš„æ™ºèƒ½åˆçº¦ä¸å‰ç«¯é›†æˆ

ğŸ‰æ‚¨ç»ˆäºåˆ°äº†è¦å®Œæˆäº†æœ¬æ•™ç¨‹ç³»åˆ—çš„æœ€åä¸€éƒ¨åˆ†ï¼šé€šè¿‡å°†æ‚¨çš„ Hello World æ™ºèƒ½åˆçº¦è¿æ¥åˆ°å‰ç«¯é¡¹ç›®å¹¶ä¸ä¹‹äº¤äº’æ¥åˆ›å»ºä¸€ä¸ªå…¨æ ˆå»ä¸­å¿ƒåŒ–åº”ç”¨ç¨‹åº (dApp)ã€‚

åœ¨æœ¬æ•™ç¨‹ç»“æŸæ—¶ï¼Œæ‚¨å°†çŸ¥é“å¦‚ä½•ï¼š

- å°† Metamask é’±åŒ…è¿æ¥åˆ°æ‚¨çš„ dApp é¡¹ç›®
- [ä½¿ç”¨Alchemy Web3](https://docs.alchemy.com/alchemy/documentation/alchemy-web3) APIä»æ‚¨çš„æ™ºèƒ½åˆçº¦ä¸­è¯»å–æ•°æ®
- ä½¿ç”¨ Metamask ç­¾ç½²ä»¥å¤ªåŠäº¤æ˜“

å¯¹äºè¿™ä¸ª dAppï¼Œæˆ‘ä»¬å°†ä½¿ç”¨[React](https://reactjs.org/)ä½œä¸ºæˆ‘ä»¬çš„å‰ç«¯æ¡†æ¶ï¼›ä½†æ˜¯ï¼Œé‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œæˆ‘ä»¬ä¸ä¼šèŠ±å¤ªå¤šæ—¶é—´åˆ†è§£å®ƒçš„åŸºç¡€ï¼Œå› ä¸ºæˆ‘ä»¬å°†ä¸»è¦ä¸“æ³¨äºå°† Web3 åŠŸèƒ½å¼•å…¥æˆ‘ä»¬çš„é¡¹ç›®ã€‚

> ä½œä¸ºå…ˆå†³æ¡ä»¶ï¼Œä½ åº”è¯¥å¯¹ React æœ‰åˆçº§çš„äº†è§£â€”â€”çŸ¥é“ç»„ä»¶ã€propsã€useState/useEffect å’ŒåŸºæœ¬çš„å‡½æ•°è°ƒç”¨æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚å¦‚æœä½ ä»¥å‰ä»æœªå¬è¯´è¿‡è¿™äº›æœ¯è¯­ï¼Œæˆ‘ä»¬å»ºè®®ä½ æŸ¥çœ‹è¿™ä¸ª[React ç®€ä»‹æ•™ç¨‹](https://reactjs.org/tutorial/tutorial.html)ã€‚å¯¹äºæ›´å¤šçš„è§†è§‰å­¦ä¹ è€…ï¼Œæˆ‘ä»¬å¼ºçƒˆæ¨èè¿™ä¸ªå¾ˆæ£’çš„ Net Ninja [Full Modern React æ•™ç¨‹](https://www.youtube.com/playlist?list=PL4cUxeGkcC9gZD-Tvwfod2gaISzfRiP9d)è§†é¢‘ç³»åˆ—ã€‚

æˆ‘ä»¬æ¥è¿™é‡Œæ˜¯ä¸ºäº†ä»€ä¹ˆï¼Ÿè®©æˆ‘ä»¬å¼€å§‹å§ï¼ğŸ˜

### ç¬¬ 1 æ­¥ï¼šå…‹éš†å¯åŠ¨æ–‡ä»¶

é¦–å…ˆï¼Œè½¬åˆ°[hello-world-part-four github å­˜å‚¨åº“](https://github.com/alchemyplatform/hello-world-part-four-tutorial)ä»¥è·å–æ­¤é¡¹ç›®çš„å¯åŠ¨æ–‡ä»¶ã€‚å°†æ­¤å­˜å‚¨åº“å…‹éš†åˆ°æ‚¨çš„æœ¬åœ°ç¯å¢ƒä¸­ã€‚

> ä¸çŸ¥é“å¦‚ä½•å…‹éš†å­˜å‚¨åº“ï¼Ÿä» GithubæŸ¥çœ‹[æœ¬æŒ‡å—ã€‚](https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/cloning-a-repository)

å½“æ‚¨æ‰“å¼€è¿™ä¸ªå…‹éš†çš„`hello-world-part-four`å­˜å‚¨åº“æ—¶ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°å®ƒåŒ…å«ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼š`starter-files`å’Œ`completed`ã€‚

`starter files`åŒ…å«è¯¥é¡¹ç›®çš„å¯åŠ¨æ–‡ä»¶ï¼ˆæœ¬è´¨ä¸Šæ˜¯ React UIï¼‰ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨æ­¤ç›®å½•ä¸­å·¥ä½œï¼Œå› ä¸ºæ‚¨å°†å­¦ä¹ å¦‚ä½•é€šè¿‡å°†å…¶è¿æ¥åˆ°æ‚¨çš„ä»¥å¤ªåŠé’±åŒ…å’Œæ‚¨åœ¨ Etherscan ä¸Šå‘å¸ƒçš„ Hello World æ™ºèƒ½åˆçº¦æ¥ä½¿æ­¤ UI æ ©æ ©å¦‚ç”Ÿç¬¬ 3 éƒ¨åˆ†ã€‚

`completed`åŒ…å«å®Œæ•´çš„å®Œæ•´æ•™ç¨‹ï¼Œå¦‚æœæ‚¨é‡åˆ°å›°éš¾ï¼Œå¯ä»¥ä½œä¸ºå‚è€ƒã€‚

æ¥ä¸‹æ¥ï¼Œç”¨æ‚¨æœ€å–œæ¬¢çš„ä»£ç ç¼–è¾‘å™¨æ‰“å¼€`starter-files`çš„æ‹·è´ï¼ˆåœ¨ Alchemyï¼Œæˆ‘ä»¬æ˜¯VScodeï¼‰ï¼Œç„¶åå¯¼èˆªåˆ°æ‚¨çš„`src`æ–‡ä»¶å¤¹ï¼š

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/202210301007909.png)

æˆ‘ä»¬å°†ç¼–å†™çš„æ‰€æœ‰ä»£ç éƒ½å°†å­˜åœ¨äºè¯¥`src`æ–‡ä»¶å¤¹ä¸‹ã€‚æˆ‘ä»¬å°†ç¼–è¾‘`HelloWorld.js`ç»„ä»¶å’Œ`util/interact.js`æ–‡ä»¶æ¥æ·»åŠ æˆ‘ä»¬çš„é¡¹ç›® Web3 åŠŸèƒ½ã€‚

### ç¬¬ 2 æ­¥ï¼šæ£€æŸ¥å¯åŠ¨æ–‡ä»¶

åœ¨æˆ‘ä»¬å¼€å§‹ç¼–ç ä¹‹å‰ï¼Œå¼„æ¸…æ¥šå¯åŠ¨æ–‡ä»¶ä¸­å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†ä»€ä¹ˆæ˜¯éå¸¸é‡è¦çš„ã€‚

#### è®©ä½ Reacté¡¹ç›®è¿è¡Œ

è®©æˆ‘ä»¬ä»åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ React é¡¹ç›®å¼€å§‹ã€‚React çš„ç¾å¦™ä¹‹å¤„åœ¨äºï¼Œä¸€æ—¦æˆ‘ä»¬çš„é¡¹ç›®åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œæˆ‘ä»¬ä¿å­˜çš„ä»»ä½•æ›´æ”¹éƒ½ä¼šåœ¨æµè§ˆå™¨ä¸­å®æ—¶æ›´æ–°ã€‚

è¦è®©é¡¹ç›®è¿è¡Œï¼Œè¯·å¯¼èˆªåˆ°æ–‡ä»¶å¤¹çš„æ ¹ç›®å½•`starter files`ï¼Œç„¶å`npm install`åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥å®‰è£…é¡¹ç›®çš„ä¾èµ–é¡¹ï¼š

```js
cd starter-files
npm install
```

å®Œæˆå®‰è£…åï¼Œåœ¨ç»ˆç«¯ä¸­è¿è¡Œ`npm start`ï¼š

```js
npm start
```

è¿™æ ·ä¼šåœ¨æ‚¨çš„æµè§ˆå™¨ä¸­æ‰“å¼€http://localhost:3000/ï¼Œæ‚¨å°†åœ¨å…¶ä¸­çœ‹åˆ°æˆ‘ä»¬é¡¹ç›®çš„å‰ç«¯ã€‚å®ƒåº”è¯¥ç”±ä¸€ä¸ªå­—æ®µï¼ˆä¸€ä¸ªæ›´æ–°å­˜å‚¨åœ¨æ™ºèƒ½åˆçº¦ä¸­çš„æ¶ˆæ¯çš„åœ°æ–¹ï¼‰ã€ä¸€ä¸ªâ€œè¿æ¥é’±åŒ…â€æŒ‰é’®å’Œä¸€ä¸ªâ€œæ›´æ–°â€æŒ‰é’®ç»„æˆã€‚

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/202210301033056.png)

å¦‚æœæ‚¨å°è¯•å•å‡»â€œè¿æ¥é’±åŒ…â€æˆ–â€œæ›´æ–°â€æŒ‰é’®ï¼Œæ‚¨ä¼šå‘ç°å®ƒä»¬ä¸èµ·ä½œç”¨â€”â€”é‚£æ˜¯å› ä¸ºæˆ‘ä»¬ä»ç„¶éœ€è¦å¯¹å®ƒä»¬çš„åŠŸèƒ½è¿›è¡Œç¼–ç¨‹ï¼:)

#### HelloWorld.js ç»„ä»¶

> **æ³¨æ„ï¼š**ç¡®ä¿æ‚¨åœ¨ starter-files æ–‡ä»¶å¤¹ä¸­ï¼Œè€Œä¸æ˜¯åœ¨completedçš„æ–‡ä»¶å¤¹ä¸­ï¼

è®©æˆ‘ä»¬å›åˆ°ç¼–è¾‘å™¨ä¸­çš„`src`æ–‡ä»¶å¤¹å¹¶æ‰“å¼€`HelloWorld.js`æ–‡ä»¶ã€‚ç†è§£è¿™ä¸ªæ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒæ˜¯æˆ‘ä»¬å°†è¦å¤„ç†çš„ä¸»è¦ React ç»„ä»¶ã€‚

åœ¨è¿™ä¸ªæ–‡ä»¶çš„é¡¶éƒ¨ï¼Œä½ ä¼šæ³¨æ„åˆ°æˆ‘ä»¬æœ‰å‡ ä¸ª import è¯­å¥æ˜¯è®©æˆ‘ä»¬çš„é¡¹ç›®è¿è¡Œæ‰€å¿…éœ€çš„ï¼ŒåŒ…æ‹¬ React åº“ã€useEffect å’Œ useState é’©å­ï¼Œä¸€äº›å…¶ä»–é¡¹`./util/interact.js`ï¼ˆæˆ‘ä»¬å¾ˆå¿«ä¼šæ›´è¯¦ç»†åœ°æè¿°å®ƒä»¬ï¼ )ï¼Œè¿˜æœ‰Alchemyçš„logoã€‚ğŸ§™

```js
import React from "react";
import { useEffect, useState } from "react";
import {
  helloWorldContract,
  connectWallet,
  updateMessage,
  loadCurrentMessage,
  getCurrentWalletConnected,
} from "./util/interact.js";

import alchemylogo from "./alchemylogo.svg";
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åœ¨ç‰¹å®šäº‹ä»¶åæ›´æ–°çŠ¶æ€å˜é‡ã€‚

```js
//State variables
const [walletAddress, setWallet] = useState("");
const [status, setStatus] = useState("");
const [message, setMessage] = useState("No connection to the network.");
const [newMessage, setNewMessage] = useState("");
```

> ä»æœªå¬è¯´è¿‡ React çŠ¶æ€å˜é‡æˆ–çŠ¶æ€é’©å­ï¼ŸæŸ¥çœ‹[è¿™äº›](https://reactjs.org/docs/hooks-state.html)æ–‡æ¡£ã€‚

#### ä»¥ä¸‹æ˜¯æ¯ä¸ªå˜é‡æ‰€ä»£è¡¨çš„å†…å®¹ï¼š

`walletAddress`- å­˜å‚¨ç”¨æˆ·é’±åŒ…åœ°å€çš„å­—ç¬¦ä¸²

`status`- å­˜å‚¨æœ‰ç”¨æ¶ˆæ¯çš„å­—ç¬¦ä¸²ï¼ŒæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•ä¸ dApp äº¤äº’

`message`- åœ¨æ™ºèƒ½åˆçº¦ä¸­å­˜å‚¨å½“å‰æ¶ˆæ¯çš„å­—ç¬¦ä¸²

`new message`- å­˜å‚¨å°†å†™å…¥æ™ºèƒ½åˆçº¦çš„æ–°æ¶ˆæ¯çš„å­—ç¬¦ä¸²

åœ¨çŠ¶æ€å˜é‡ä¹‹åï¼Œæ‚¨å°†çœ‹åˆ°äº”ä¸ªæœªå®ç°çš„å‡½æ•°ï¼š`useEffect`ã€`addSmartContractListener`ã€`connectWalletPressed`å’Œ`onUpdatePressed`ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹é¢è§£é‡Šå®ƒä»¬çš„ä½œç”¨ï¼š

```js
//called only once
useEffect(async () => { //TODO: implement

}, []);

function addSmartContractListener() { //TODO: implement

}

function addWalletListener() { //TODO: implement

}

const connectWalletPressed = async () => { //TODO: implement

};

const onUpdatePressed = async () => { //TODO: implement

};
```

`useEffect`- è¿™æ˜¯ä¸€ä¸ª React é’©å­ï¼Œåœ¨æ¸²æŸ“ç»„ä»¶åè°ƒç”¨ã€‚å› ä¸ºå®ƒæœ‰ä¸€ä¸ªç©ºæ•°ç»„ [] ä¼ é€’ç»™å®ƒï¼ˆè§ç¬¬ 4 è¡Œï¼‰ï¼Œå®ƒåªä¼šåœ¨ç»„ä»¶çš„ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶è¢«è°ƒç”¨ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†åŠ è½½å­˜å‚¨åœ¨æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ä¸­çš„å½“å‰æ¶ˆæ¯ï¼Œè°ƒç”¨æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦å’Œé’±åŒ…ç›‘å¬å™¨ï¼Œå¹¶æ›´æ–°æˆ‘ä»¬çš„ UI ä»¥åæ˜ é’±åŒ…æ˜¯å¦å·²ç»è¿æ¥ã€‚

`addSmartContractListener`- è¿™ä¸ªå‡½æ•°è®¾ç½®äº†ä¸€ä¸ªç›‘å¬å™¨ï¼Œå®ƒå°†ç›‘å¬æˆ‘ä»¬çš„ HelloWorld åˆçº¦çš„`UpdatedMessages`äº‹ä»¶ï¼Œå¹¶åœ¨æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ä¸­çš„æ¶ˆæ¯å‘ç”Ÿæ›´æ”¹æ—¶æ›´æ–°æˆ‘ä»¬çš„ UIã€‚

`addWalletListener`- æ­¤å‡½æ•°è®¾ç½®ä¸€ä¸ªç›‘å¬å™¨ï¼Œæ£€æµ‹ç”¨æˆ· Metamask é’±åŒ…çŠ¶æ€çš„å˜åŒ–ï¼Œä¾‹å¦‚ç”¨æˆ·æ–­å¼€é’±åŒ…æˆ–åˆ‡æ¢åœ°å€æ—¶ã€‚

`connectWalletPressed`- å°†è°ƒç”¨æ­¤å‡½æ•°å°†ç”¨æˆ·çš„ Metamask é’±åŒ…è¿æ¥åˆ°æˆ‘ä»¬çš„ dAppã€‚

`onUpdatePressed`- å½“ç”¨æˆ·æƒ³è¦æ›´æ–°å­˜å‚¨åœ¨æ™ºèƒ½åˆçº¦ä¸­çš„æ¶ˆæ¯æ—¶ï¼Œå°†è°ƒç”¨æ­¤å‡½æ•°ã€‚

åœ¨è¿™ä¸ªæ–‡ä»¶çš„æœ«å°¾ï¼Œæˆ‘ä»¬æœ‰æˆ‘ä»¬ç»„ä»¶çš„ UIã€‚

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/202210301041443.png)

**å¦‚æœæ‚¨ä»”ç»†æµè§ˆæ­¤ä»£ç ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°æˆ‘ä»¬åœ¨ UI ä¸­ä½¿ç”¨å„ç§çŠ¶æ€å˜é‡çš„ä½ç½®**

åœ¨ç¬¬6-12è¡Œï¼Œå¦‚æœç”¨æˆ·çš„é’±åŒ…è¢«è¿æ¥ï¼ˆå³`walletAddress.length>0`ï¼‰ï¼Œæˆ‘ä»¬åœ¨IDä¸º "walletButton "çš„æŒ‰é’®ä¸­æ˜¾ç¤ºç”¨æˆ·`walletAddress`çš„æˆªæ–­ç‰ˆæœ¬ï¼›å¦åˆ™ï¼Œå®ƒåªæ˜¯è¯´ "Connect Wallet."ã€‚

åœ¨ç¬¬ 17 è¡Œï¼Œæˆ‘ä»¬æ˜¾ç¤ºå­˜å‚¨åœ¨æ™ºèƒ½åˆçº¦ä¸­çš„å½“å‰æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯è¢«å­˜å‚¨åœ¨` message`å­—ç¬¦ä¸²ä¸­ã€‚

åœ¨ç¬¬ 23-26 è¡Œï¼Œæˆ‘ä»¬ä½¿ç”¨å½“æ–‡æœ¬å­—æ®µä¸­çš„è¾“å…¥å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ§åˆ¶ç»„ä»¶æ›´æ–°æˆ‘ä»¬çš„`newMessage`çŠ¶æ€å˜é‡ã€‚

é™¤äº†æˆ‘ä»¬çš„çŠ¶æ€å˜é‡ï¼Œä½ è¿˜ä¼šçœ‹åˆ°ï¼Œå½“IDä¸ºpublishButtonå’ŒwalletButtonçš„æŒ‰é’®è¢«ç‚¹å‡»æ—¶ï¼ŒconnectWalletPressedå’ŒonUpdatePressedå‡½æ•°è¢«è°ƒç”¨ã€‚

æœ€åè®©æˆ‘ä»¬è§£å†³è¿™ä¸ª`HelloWorld.js`ç»„ä»¶åœ¨å“ªé‡Œæ·»åŠ ã€‚

å¦‚æœä½ å»çœ‹App.jsï¼Œå®ƒæ˜¯Reactçš„ä¸»è¦ç»„ä»¶ï¼Œä½œä¸ºæ‰€æœ‰å…¶ä»–ç»„ä»¶çš„å®¹å™¨ï¼Œä½ ä¼šçœ‹åˆ°æˆ‘ä»¬çš„HelloWorld.jsç»„ä»¶åœ¨ç¬¬7è¡Œè¢«æ³¨å…¥ã€‚

æœ€åä½†å¹¶éæœ€ä¸é‡è¦çš„æ˜¯ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä¸ºä½ æä¾›çš„å¦ä¸€ä¸ªæ–‡ä»¶ï¼Œinteractive.jsæ–‡ä»¶ã€‚

#### interact.jsæ–‡ä»¶

å› ä¸ºæˆ‘ä»¬è¦éµå®ˆM-V-CèŒƒå¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ï¼ŒåŒ…å«æˆ‘ä»¬æ‰€æœ‰çš„å‡½æ•°æ¥ç®¡ç†æˆ‘ä»¬çš„DAppçš„é€»è¾‘ã€æ•°æ®å’Œè§„åˆ™ï¼Œç„¶åèƒ½å¤Ÿå°†è¿™äº›å‡½æ•°è¾“å‡ºåˆ°æˆ‘ä»¬çš„å‰ç«¯ï¼ˆæˆ‘ä»¬çš„HelloWorld.jsç»„ä»¶ï¼‰ã€‚

ğŸ‘†ğŸ½è¿™å°±æ˜¯æˆ‘ä»¬çš„interactive.jsæ–‡ä»¶çš„ç¡®åˆ‡ç›®çš„!

å¯¼èˆªåˆ°srcç›®å½•ä¸‹çš„utilæ–‡ä»¶å¤¹ï¼Œä½ ä¼šæ³¨æ„åˆ°æˆ‘ä»¬å·²ç»åŒ…å«äº†ä¸€ä¸ªåä¸º`interactive.js`çš„æ–‡ä»¶ï¼Œå®ƒå°†åŒ…å«æˆ‘ä»¬æ‰€æœ‰çš„æ™ºèƒ½åˆçº¦äº¤äº’å’Œé’±åŒ…å‡½æ•°å’Œå˜é‡ã€‚

```js
//export const helloWorldContract;

export const loadCurrentMessage = async () => {

};

export const connectWallet = async () => {

};

const getCurrentWalletConnected = async () => {

};


export const updateMessage = async (message) => {

};
```

ä½ ä¼šæ³¨æ„åˆ°åœ¨æ–‡ä»¶çš„é¡¶éƒ¨ï¼Œæˆ‘ä»¬å·²ç»æ³¨é‡Šäº†`helloWorldContract`å¯¹è±¡ã€‚åœ¨æœ¬æ•™ç¨‹çš„åé¢ï¼Œæˆ‘ä»¬å°†å–æ¶ˆå¯¹è¿™ä¸ªå¯¹è±¡çš„æ³¨é‡Šï¼Œå¹¶åœ¨è¿™ä¸ªå˜é‡ä¸­å®ä¾‹åŒ–æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ï¼Œç„¶åæˆ‘ä»¬å°†æŠŠå®ƒå¯¼å‡ºåˆ°æˆ‘ä»¬çš„`HelloWorld.js`ç»„ä»¶ã€‚

åœ¨æˆ‘ä»¬çš„helloWorldContractå¯¹è±¡ä¹‹åçš„å››ä¸ªæœªå®ç°çš„å‡½æ•°,åšäº†ä»¥ä¸‹äº‹æƒ…:

loadCurrentMessage--è¯¥å‡½æ•°å¤„ç†åŠ è½½å­˜å‚¨åœ¨æ™ºèƒ½åˆçº¦ä¸­çš„å½“å‰æ¶ˆæ¯çš„é€»è¾‘ã€‚å®ƒå°†ä½¿ç”¨Alchemy Web3 APIå¯¹Hello Worldæ™ºèƒ½åˆçº¦è¿›è¡Œè¯»å–è°ƒç”¨ã€‚

connectWallet- æ­¤å‡½æ•°å°†è¿æ¥ç”¨æˆ·çš„Metamaskåˆ°æˆ‘ä»¬çš„DAppã€‚

getCurrentWalletConnected- æ­¤å‡½æ•°å°†åœ¨é¡µé¢åŠ è½½æ—¶æ£€æŸ¥Ethereumè´¦æˆ·æ˜¯å¦å·²ç»è¿æ¥åˆ°æˆ‘ä»¬çš„dAppï¼Œå¹¶ç›¸åº”åœ°æ›´æ–°æˆ‘ä»¬çš„UIã€‚

updateMessage è¿™ä¸ªå‡½æ•°å°†æ›´æ–°å­˜å‚¨åœ¨æ™ºèƒ½åˆçº¦ä¸­çš„æ¶ˆæ¯ã€‚å®ƒå°†å¯¹Hello Worldæ™ºèƒ½åˆçº¦è¿›è¡Œå†™å…¥è°ƒç”¨ï¼Œå› æ­¤ç”¨æˆ·çš„Metamaské’±åŒ…å°†ä¸å¾—ä¸ç­¾ç½²ä¸€ä¸ªä»¥å¤ªåŠäº¤æ˜“æ¥æ›´æ–°æ¶ˆæ¯ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬æ˜ç™½äº†æˆ‘ä»¬çš„å·¥ä½œå†…å®¹ï¼Œè®©æˆ‘ä»¬æ¥å¼„æ¸…æ¥šå¦‚ä½•ä»æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ä¸­è¯»å–ä¿¡æ¯å§

### ç¬¬3æ­¥ï¼šä»ä½ çš„æ™ºèƒ½åˆçº¦ä¸­è¯»å–ä¿¡æ¯

è¦ä»ä½ çš„æ™ºèƒ½åˆçº¦ä¸­è¯»å–ï¼Œä½ éœ€è¦æˆåŠŸè®¾ç½®ã€‚

- ä¸€ä¸ªä¸ä»¥å¤ªåŠé“¾çš„APIè¿æ¥
- ä¸€ä¸ªåŠ è½½çš„æ™ºèƒ½åˆçº¦å®ä¾‹
- ä¸€ä¸ªè°ƒç”¨ä½ çš„æ™ºèƒ½åˆçº¦åŠŸèƒ½çš„å‡½æ•°
- ä¸€ä¸ªç›‘å¬å™¨ï¼Œå½“ä½ ä»æ™ºèƒ½åˆçº¦ä¸­è¯»å–çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç›‘å¬å™¨ä¼šæ³¨æ„æ›´æ–°ã€‚

è¿™å¬èµ·æ¥å¯èƒ½æœ‰å¾ˆå¤šæ­¥éª¤ï¼Œä½†ä¸è¦æ‹…å¿ƒï¼æˆ‘ä»¬å°†æŒ‡å¯¼ä½ å¦‚ä½•å®Œæˆè¿™äº›æ­¥éª¤ã€‚æˆ‘ä»¬ä¼šä¸€æ­¥ä¸€æ­¥åœ°æŒ‡å¯¼ä½ å¦‚ä½•åšæ¯ä¸€ä¸ªæ­¥éª¤! :)

#### å»ºç«‹ä¸€ä¸ªä¸ä»¥å¤ªåŠé“¾çš„APIè¿æ¥

è¿˜è®°å¾—åœ¨æœ¬æ•™ç¨‹çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œæˆ‘ä»¬æ˜¯å¦‚ä½•[ä½¿ç”¨Alchemy Web3å¯†é’¥æ¥è¯»å–æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦](https://docs.alchemy.com/alchemy/tutorials/hello-world-smart-contract/interacting-with-a-smart-contract#step-1-install-web3-library)çš„å—ï¼Ÿä½ ä¹Ÿéœ€è¦ä¸€ä¸ªAlchemy Web3å¯†é’¥åœ¨ä½ çš„DAppä¸­ä»é“¾ä¸Šè¯»å–æ•°æ®ã€‚

å¦‚æœæ‚¨è¿˜æ²¡æœ‰å®‰è£…Alchemy Web3ï¼Œè¯·é¦–å…ˆå®‰è£…å®ƒã€‚æ–¹æ³•æ˜¯æµè§ˆæ‚¨çš„å¯åŠ¨æ–‡ä»¶çš„æ ¹ç›®å½•ï¼Œå¹¶åœ¨æ‚¨çš„ç»ˆç«¯ä¸Šè¿è¡Œä»¥ä¸‹å†…å®¹å¯åŠ¨æ–‡ä»¶å¹¶åœ¨æ‚¨çš„ç»ˆç«¯ä¸Šè¿è¡Œä»¥ä¸‹å†…å®¹

```js
npm install @alch/alchemy-web3
```

> [Alchemy Web3](https://github.com/alchemyplatform/alchemy-web3)æ˜¯ä¸€ä¸ªå›´ç»•[Web3.js](https://web3js.readthedocs.io/en/v1.2.9/)çš„å°è£…å™¨ï¼Œæä¾›äº†å¢å¼ºçš„APIæ–¹æ³•å’Œå…¶ä»–é‡è¦çš„å¥½å¤„ï¼Œä½¿ä½ ä½œä¸ºä¸€ä¸ªWeb3å¼€å‘è€…çš„ç”Ÿæ´»æ›´å®¹æ˜“ã€‚å®ƒçš„è®¾è®¡éœ€è¦æœ€å°çš„é…ç½®ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç«‹å³å¼€å§‹åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒ

ç„¶åï¼Œåœ¨ä½ çš„é¡¹ç›®ç›®å½•ä¸­å®‰è£…[dotenv](https://www.npmjs.com/package/dotenv)åŒ…ï¼Œè¿™æ ·æˆ‘ä»¬å°±æœ‰ä¸€ä¸ªå®‰å…¨çš„åœ°æ–¹æ¥å­˜å‚¨æˆ‘ä»¬çš„APIå¯†é’¥ï¼Œåœ¨æˆ‘ä»¬è·å–å®ƒä¹‹åã€‚

```js
npm install dotenv --save
```

å¯¹äºæˆ‘ä»¬çš„DAppï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æˆ‘ä»¬çš„Websockets APIå¯†é’¥ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬çš„HTTP APIå¯†é’¥ï¼Œå› ä¸ºå®ƒå°†å…è®¸æˆ‘ä»¬è®¾ç½®ä¸€ä¸ªç›‘å¬å™¨ï¼Œä»¥æ£€æµ‹å­˜å‚¨åœ¨æ™ºèƒ½åˆçº¦ä¸­çš„æ¶ˆæ¯ä½•æ—¶å‘ç”Ÿå˜åŒ–ã€‚

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/202210301052448.gif)

ä¸€æ—¦ä½ æœ‰äº†ä½ çš„APIå¯†é’¥ï¼Œåœ¨ä½ çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`.env`æ–‡ä»¶ï¼Œå¹¶å°†ä½ çš„Alchemy Websocketsç½‘å€æ·»åŠ åˆ°å…¶ä¸­ã€‚ä¹‹åï¼Œä½ çš„.envæ–‡ä»¶åº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·ã€‚

```js
REACT_APP_ALCHEMY_KEY = wss://eth-goerli.ws.alchemyapi.io/v2/
```

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å‡†å¤‡å¥½åœ¨æˆ‘ä»¬çš„dAppä¸­è®¾ç½®æˆ‘ä»¬çš„Alchemy Web3ç«¯ç‚¹äº†! è®©æˆ‘ä»¬å›åˆ°åµŒå¥—åœ¨`util`æ–‡ä»¶å¤¹ä¸­çš„`interactive.js`ï¼Œå¹¶åœ¨æ–‡ä»¶çš„é¡¶éƒ¨æ·»åŠ ä»¥ä¸‹ä»£ç ã€‚

```js
require('dotenv').config();
const alchemyKey = process.env.REACT_APP_ALCHEMY_KEY;
const { createAlchemyWeb3 } = require("@alch/alchemy-web3");
const web3 = createAlchemyWeb3(alchemyKey);

//export const helloWorldContract;
```

ä¸Šé¢ï¼Œæˆ‘ä»¬é¦–å…ˆä»æˆ‘ä»¬çš„.envæ–‡ä»¶ä¸­å¯¼å…¥äº†Alchemy ketï¼Œç„¶åå°†æˆ‘ä»¬çš„alchemyKeyä¼ é€’ç»™createAlchemyWeb3ä»¥å»ºç«‹æˆ‘ä»¬çš„Alchemy Web3ç«¯ç‚¹ã€‚

å‡†å¤‡å¥½è¿™ä¸ªç«¯ç‚¹åï¼Œå°±å¯ä»¥åŠ è½½æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦äº†ã€‚

#### åŠ è½½ä½ çš„Hello Worldæ™ºèƒ½åˆçº¦

è¦åŠ è½½æ‚¨çš„Hello Worldæ™ºèƒ½åˆçº¦ï¼Œæ‚¨éœ€è¦å®ƒçš„åˆçº¦åœ°å€å’ŒABIï¼Œå¦‚æœæ‚¨å®Œæˆäº†æœ¬æ•™ç¨‹çš„ç¬¬ä¸‰éƒ¨åˆ†ï¼Œå°±å¯ä»¥åœ¨Etherscanä¸Šæ‰¾åˆ°è¿™ä¸¤ä¸ªä¿¡æ¯ã€‚

ä¸€æ—¦ä½ æœ‰äº†ä½ çš„APIå¯†é’¥ï¼Œåœ¨ä½ çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª.envæ–‡ä»¶ï¼Œå¹¶å°†ä½ çš„Alchemy Websocketsç½‘å€æ·»åŠ åˆ°å…¶ä¸­ã€‚ä¹‹åï¼Œä½ çš„.envæ–‡ä»¶åº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·ã€‚

```js
REACT_APP_ALCHEMY_KEY = wss://eth-goerli.ws.alchemyapi.io/v2/
```

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å‡†å¤‡å¥½åœ¨æˆ‘ä»¬çš„dAppä¸­è®¾ç½®æˆ‘ä»¬çš„Alchemy Web3ç«¯ç‚¹äº†! è®©æˆ‘ä»¬å›åˆ°åµŒå¥—åœ¨utilæ–‡ä»¶å¤¹ä¸­çš„interactive.jsï¼Œå¹¶åœ¨æ–‡ä»¶çš„é¡¶éƒ¨æ·»åŠ ä»¥ä¸‹ä»£ç ã€‚

```js
require('dotenv').config();
const alchemyKey = process.env.REACT_APP_ALCHEMY_KEY;
const { createAlchemyWeb3 } = require("@alch/alchemy-web3");
const web3 = createAlchemyWeb3(alchemyKey);

//export const helloWorldContract;
```

ä¸Šé¢ï¼Œæˆ‘ä»¬é¦–å…ˆä»æˆ‘ä»¬çš„.envæ–‡ä»¶ä¸­å¯¼å…¥äº†Alchemy ketï¼Œç„¶åå°†æˆ‘ä»¬çš„alchemyKeyä¼ é€’ç»™createAlchemyWeb3ä»¥å»ºç«‹æˆ‘ä»¬çš„Alchemy Web3ç«¯ç‚¹ã€‚

å‡†å¤‡å¥½è¿™ä¸ªç«¯ç‚¹åï¼Œå°±å¯ä»¥åŠ è½½æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦äº†ã€‚

#### åŠ è½½ä½ çš„Hello Worldæ™ºèƒ½åˆçº¦

è¦åŠ è½½æ‚¨çš„Hello Worldæ™ºèƒ½åˆçº¦ï¼Œæ‚¨éœ€è¦å®ƒçš„åˆçº¦åœ°å€å’ŒABIï¼Œå¦‚æœæ‚¨å®Œæˆäº†æœ¬æ•™ç¨‹çš„ç¬¬ä¸‰éƒ¨åˆ†ï¼Œå°±å¯ä»¥åœ¨Etherscanä¸Šæ‰¾åˆ°è¿™ä¸¤ä¸ªä¿¡æ¯ã€‚

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/202210301053016.gif)

> å¦‚æœä½ è·³è¿‡äº†æœ¬æ•™ç¨‹çš„ç¬¬ä¸‰éƒ¨åˆ†ï¼Œä½ å¯ä»¥ä½¿ç”¨åœ°å€ä¸º[0x6f3f635A9762B47954229Ea479b4541eAF402A6A](https://ropsten.etherscan.io/address/0x6f3f635a9762b47954229ea479b4541eaf402a6a#code)çš„HelloWorldåˆçº¦ã€‚[å®ƒçš„ABIå¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°](https://ropsten.etherscan.io/address/0x6f3f635a9762b47954229ea479b4541eaf402a6a#code)ã€‚

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/202210301053175.png)

æœ‰äº†æˆ‘ä»¬çš„åˆçº¦åœ°å€ã€ABIå’ŒAlchemy Web3ç«¯ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åˆçº¦æ–¹æ³•æ¥åŠ è½½æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦å®ä¾‹ã€‚å°†ä½ çš„åˆçº¦ABIå¯¼å…¥interactive.jsæ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä½ çš„åˆçº¦åœ°å€ã€‚

```js
const contractABI = require("../contract-abi.json");
const contractAddress = "0x6f3f635A9762B47954229Ea479b4541eAF402A6A";
```

ç°åœ¨æˆ‘ä»¬ç»ˆäºå¯ä»¥å–æ¶ˆå¯¹helloWorldContractå˜é‡çš„æ³¨é‡Šï¼Œå¹¶ä½¿ç”¨æˆ‘ä»¬çš„AlchemyWeb3ç«¯ç‚¹åŠ è½½æ™ºèƒ½åˆçº¦ã€‚

```js
export const helloWorldContract = new web3.eth.Contract(
  contractABI,
  contractAddress
);
```

å›é¡¾ä¸€ä¸‹ï¼Œä½ çš„interactive.jsçš„å‰12è¡Œç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚

```js
require('dotenv').config();
const alchemyKey = process.env.REACT_APP_ALCHEMY_KEY;
const { createAlchemyWeb3 } = require("@alch/alchemy-web3");
const web3 = createAlchemyWeb3(alchemyKey);

const contractABI = require('../contract-abi.json')
const contractAddress = "0x6f3f635A9762B47954229Ea479b4541eAF402A6A";

export const helloWorldContract = new web3.eth.Contract(
  contractABI,
  contractAddress
);
```

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»åŠ è½½äº†æˆ‘ä»¬çš„åˆåŒï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æˆ‘ä»¬çš„loadCurrentMessageå‡½æ•°äº†ã€‚

#### åœ¨ä½ çš„interactive.jsæ–‡ä»¶ä¸­å®ç°loadCurrentMessage

è¿™ä¸ªå‡½æ•°è¶…çº§ç®€å•ã€‚å°±åƒæˆ‘ä»¬åœ¨æœ¬æ•™ç¨‹ç³»åˆ—çš„ç¬¬äºŒéƒ¨åˆ†æ‰€åšçš„é‚£æ ·ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬è¦åšä¸€ä¸ªç®€å•çš„å¼‚æ­¥web3è°ƒç”¨æ¥è¯»å–æˆ‘ä»¬çš„åˆåŒã€‚æˆ‘ä»¬çš„å‡½æ•°å°†è¿”å›å­˜å‚¨åœ¨æ™ºèƒ½åˆçº¦ä¸­çš„æ¶ˆæ¯ã€‚

å°†ä½ çš„interactive.jsæ–‡ä»¶ä¸­çš„loadCurrentMessageæ›´æ–°ä¸ºä»¥ä¸‹å†…å®¹ã€‚

```js
export const loadCurrentMessage = async () => {
    const message = await helloWorldContract.methods.message().call();
    return message;
};
```

ç”±äºæˆ‘ä»¬æƒ³åœ¨æˆ‘ä»¬çš„ç”¨æˆ·ç•Œé¢ä¸­æ˜¾ç¤ºè¿™ä¸ªæ™ºèƒ½åˆçº¦ï¼Œè®©æˆ‘ä»¬æŠŠHelloWorld.jsç»„ä»¶ä¸­çš„useEffectå‡½æ•°æ›´æ–°ä¸ºä»¥ä¸‹å†…å®¹ã€‚

```js
//called only once
useEffect(async () => {
    const message = await loadCurrentMessage();
    setMessage(message);
}, []);
```

æ³¨æ„ï¼Œæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„loadCurrentMessageåœ¨ç»„ä»¶çš„ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶è¢«è°ƒç”¨ä¸€æ¬¡ã€‚æˆ‘ä»¬å¾ˆå¿«å°±ä¼šå®ç°addSmartContractListenerï¼Œä»¥ä¾¿åœ¨æ™ºèƒ½åˆçº¦ä¸­çš„æ¶ˆæ¯æ”¹å˜åè‡ªåŠ¨æ›´æ–°ç”¨æˆ·ç•Œé¢ã€‚

åœ¨æˆ‘ä»¬æ·±å…¥ç ”ç©¶æˆ‘ä»¬çš„ç›‘å¬å™¨ä¹‹å‰ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬ç›®å‰æ‰€æ‹¥æœ‰çš„ä¸œè¥¿å§ ä¿å­˜ä½ çš„HelloWorld.jså’Œinteractive.jsæ–‡ä»¶ï¼Œç„¶åè½¬åˆ°http://localhost:3000/

ä½ ä¼šæ³¨æ„åˆ°ï¼Œå½“å‰çš„æ¶ˆæ¯ä¸å†è¯´ "æ²¡æœ‰è¿æ¥åˆ°ç½‘ç»œ"ã€‚ç›¸åï¼Œå®ƒåæ˜ äº†å­˜å‚¨åœ¨æ™ºèƒ½åˆçº¦ä¸­çš„ä¿¡æ¯ã€‚æœ‰ç—…å•Š!

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/202210301054927.png)

ç°åœ¨è¯´è¯´é‚£ä¸ªç›‘å¬å™¨...

#### å®ç°addSmartContractListener

å¦‚æœä½ å›æƒ³ä¸€ä¸‹æˆ‘ä»¬åœ¨æœ¬æ•™ç¨‹ç³»åˆ—ç¬¬ä¸€éƒ¨åˆ†ä¸­å†™çš„`HelloWorld.sol`æ–‡ä»¶ï¼Œä½ ä¼šè®°å¾—æœ‰ä¸€ä¸ªåä¸ºUpdateMessagesçš„æ™ºèƒ½åˆçº¦äº‹ä»¶ï¼Œåœ¨æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦çš„æ›´æ–°å‡½æ•°è¢«è°ƒç”¨åè¢«å‘å°„å‡ºæ¥ï¼ˆè§ç¬¬9å’Œ27è¡Œï¼‰ã€‚

```js
// Specifies the version of Solidity, using semantic versioning.
// Learn more: https://solidity.readthedocs.io/en/v0.5.10/layout-of-source-files.html#pragma
pragma solidity ^0.7.3;

// Defines a contract named `HelloWorld`.
// A contract is a collection of functions and data (its state). Once deployed, a contract resides at a specific address on the Ethereum blockchain. Learn more: https://solidity.readthedocs.io/en/v0.5.10/structure-of-a-contract.html
contract HelloWorld {

   //Emitted when update function is called
   //Smart contract events are a way for your contract to communicate that something happened on the blockchain to your app front-end, which can be 'listening' for certain events and take action when they happen.
   event UpdatedMessages(string oldStr, string newStr);

   // Declares a state variable `message` of type `string`.
   // State variables are variables whose values are permanently stored in contract storage. The keyword `public` makes variables accessible from outside a contract and creates a function that other contracts or clients can call to access the value.
   string public message;

   // Similar to many class-based object-oriented languages, a constructor is a special function that is only executed upon contract creation.
   // Constructors are used to initialize the contract's data. Learn more:https://solidity.readthedocs.io/en/v0.5.10/contracts.html#constructors
   constructor(string memory initMessage) {

      // Accepts a string argument `initMessage` and sets the value into the contract's `message` storage variable).
      message = initMessage;
   }

   // A public function that accepts a string argument and updates the `message` storage variable.
   function update(string memory newMessage) public {
      string memory oldMsg = message;
      message = newMessage;
      emit UpdatedMessages(oldMsg, newMessage);
   }
}
```

> æ™ºèƒ½åˆçº¦äº‹ä»¶æ˜¯ä½ çš„åˆçº¦å‘ä½ çš„å‰ç«¯åº”ç”¨ç¨‹åºä¼ è¾¾åŒºå—é“¾ä¸Šå‘ç”Ÿçš„äº‹æƒ…ï¼ˆå³æœ‰ä¸€ä¸ªäº‹ä»¶ï¼‰çš„ä¸€ç§æ–¹å¼ï¼Œå®ƒå¯ä»¥ "ç›‘å¬ "ç‰¹å®šçš„äº‹ä»¶å¹¶åœ¨å®ƒä»¬å‘ç”Ÿæ—¶é‡‡å–è¡ŒåŠ¨ã€‚

addSmartContractListenerå‡½æ•°å°†ä¸“é—¨ç›‘å¬æˆ‘ä»¬çš„Hello Worldæ™ºèƒ½åˆçº¦çš„UpdateMessagesäº‹ä»¶ï¼Œå¹¶æ›´æ–°æˆ‘ä»¬çš„ç”¨æˆ·ç•Œé¢ä»¥æ˜¾ç¤ºæ–°æ¶ˆæ¯ã€‚

å°†addSmartContractListenerä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹ã€‚

```js
function addSmartContractListener() {
  helloWorldContract.events.UpdatedMessages({}, (error, data) => {
    if (error) {
      setStatus("ğŸ˜¥ " + error.message);
    } else {
      setMessage(data.returnValues[1]);
      setNewMessage("");
      setStatus("ğŸ‰ Your message has been updated!");
    }
  });
}
```

#### è®©æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹å½“ç›‘å¬å™¨æ£€æµ‹åˆ°ä¸€ä¸ªäº‹ä»¶æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚

å¦‚æœäº‹ä»¶å‘å‡ºæ—¶å‘ç”Ÿäº†é”™è¯¯ï¼Œå®ƒå°†é€šè¿‡æˆ‘ä»¬çš„çŠ¶æ€å˜é‡åæ˜ åœ¨ç”¨æˆ·ç•Œé¢ä¸­ã€‚

å¦åˆ™ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿”å›çš„æ•°æ®å¯¹è±¡ã€‚data.returnValuesæ˜¯ä¸€ä¸ªç´¢å¼•ä¸º0çš„æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å­˜å‚¨äº†ä¹‹å‰çš„æ¶ˆæ¯ï¼Œç¬¬äºŒä¸ªå…ƒç´ å­˜å‚¨äº†æ›´æ–°åçš„æ¶ˆæ¯ã€‚æ€»ä¹‹ï¼Œåœ¨ä¸€ä¸ªæˆåŠŸçš„äº‹ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„æ¶ˆæ¯å­—ç¬¦ä¸²è®¾ç½®ä¸ºæ›´æ–°çš„æ¶ˆæ¯ï¼Œæ¸…é™¤newMessageå­—ç¬¦ä¸²ï¼Œå¹¶æ›´æ–°æˆ‘ä»¬çš„çŠ¶æ€å˜é‡ä»¥åæ˜ æ–°çš„æ¶ˆæ¯å·²ç»åœ¨æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ä¸Šå‘å¸ƒã€‚

æœ€åï¼Œè®©æˆ‘ä»¬åœ¨useEffectå‡½æ•°ä¸­è°ƒç”¨æˆ‘ä»¬çš„ç›‘å¬å™¨ï¼Œä»¥ä¾¿å®ƒåœ¨HelloWorld.jsç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶è¢«åˆå§‹åŒ–ã€‚æ€»çš„æ¥è¯´ï¼Œä½ çš„useEffectå‡½æ•°åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚

```js
useEffect(async () => {
    const message = await loadCurrentMessage();
    setMessage(message);
    addSmartContractListener();
}, []);
```

ç°åœ¨æˆ‘ä»¬å·²ç»èƒ½å¤Ÿä»æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ä¸­è¯»å–ä¿¡æ¯äº†ï¼Œå¦‚æœèƒ½å¼„æ¸…æ¥šå¦‚ä½•å‘å®ƒå†™å…¥ä¿¡æ¯ï¼Œé‚£å°±æ›´å¥½äº†ï¼ç„¶è€Œï¼Œè¦å‘æˆ‘ä»¬çš„DAppå†™å…¥ä¿¡æ¯ï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆæœ‰ä¸€ä¸ªè¿æ¥åˆ°Ethereumé’±åŒ…ã€‚ç„¶è€Œï¼Œè¦å†™åˆ°æˆ‘ä»¬çš„DAppï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆæœ‰ä¸€ä¸ªä»¥å¤ªåŠé’±åŒ…è¿æ¥åˆ°å®ƒã€‚

å› æ­¤ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†è§£å†³è®¾ç½®æˆ‘ä»¬çš„Ethereumé’±åŒ…ï¼ˆMetamaskï¼‰ï¼Œç„¶åå°†å…¶è¿æ¥åˆ°æˆ‘ä»¬çš„DAppä¸Š!

### ç¬¬4æ­¥ï¼šè®¾ç½®ä½ çš„ä»¥å¤ªåŠé’±åŒ…

è¦å‘ä»¥å¤ªåŠé“¾å†™å…¥ä»»ä½•ä¸œè¥¿ï¼Œç”¨æˆ·å¿…é¡»ä½¿ç”¨ä»–ä»¬çš„è™šæ‹Ÿé’±åŒ…çš„ç§é’¥ç­¾ç½²äº¤æ˜“ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨[Metamask](https://metamask.io/)ï¼Œä¸€ä¸ªç”¨äºç®¡ç†ä½ çš„ä»¥å¤ªåŠè´¦æˆ·åœ°å€çš„æµè§ˆå™¨ä¸­çš„è™šæ‹Ÿé’±åŒ…ï¼Œå› ä¸ºå®ƒä½¿è¿™ç§äº¤æ˜“ç­¾ç½²å¯¹ç»ˆç«¯ç”¨æˆ·æ¥è¯´è¶…çº§ç®€å•ã€‚

> å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºä»¥å¤ªåŠäº¤æ˜“çš„è¿ä½œæ–¹å¼ï¼Œè¯·æŸ¥çœ‹[ä»¥å¤ªåŠåŸºé‡‘ä¼š](https://ethereum.org/en/developers/docs/transactions/)çš„è¿™ä¸ªé¡µé¢ã€‚

#### ä¸‹è½½Metamask

ä½ å¯ä»¥åœ¨è¿™é‡Œ[å…è´¹ä¸‹è½½å¹¶åˆ›å»ºä¸€ä¸ªMetamaskè´¦æˆ·](https://metamask.io/download.html)ã€‚å½“ä½ åœ¨åˆ›å»ºè´¦æˆ·æ—¶ï¼Œæˆ–è€…å¦‚æœä½ å·²ç»æœ‰ä¸€ä¸ªè´¦æˆ·ï¼Œç¡®ä¿åˆ‡æ¢åˆ°å³ä¸Šæ–¹çš„ "Ropstenæµ‹è¯•ç½‘ç»œ"ï¼ˆè¿™æ ·æˆ‘ä»¬å°±ä¸ä¼šå’ŒçœŸå®çš„é’±æ‰“äº¤é“ï¼‰ã€‚

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/202210301055802.png)

#### ä»æ°´é¾™å¤´ä¸­æ·»åŠ ether

ä¸ºäº†åœ¨ä»¥å¤ªåŠåŒºå—é“¾ä¸Šç­¾ç½²äº¤æ˜“ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›å‡çš„Ethã€‚è¦è·å¾—Ethï¼Œä½ å¯ä»¥å»[Ropsten faucet](https://faucet.ropsten.be/)ï¼Œè¾“å…¥ä½ çš„Ropstenè´¦æˆ·åœ°å€ï¼Œç„¶åç‚¹å‡» "å‘é€Ropsten Eth"ã€‚ä½ åº”è¯¥å¾ˆå¿«åœ¨ä½ çš„Metamaskè´¦æˆ·ä¸­çœ‹åˆ°Eth!

#### æ£€æŸ¥æ‚¨çš„ä½™é¢

ä¸ºäº†ä»”ç»†æ£€æŸ¥æˆ‘ä»¬çš„ä½™é¢ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨[Alchemyâ€™s composer tool](https://composer.alchemyapi.io/?composer_state={"network"%3A0%2C"methodName"%3A"eth_getBalance"%2C"paramValues"%3A[""%2C"latest"]})åšä¸€ä¸ªhttps://docs.alchemyapi.io/alchemy/documentation/alchemy-api-reference/json-rpc#eth_getbalanceè¯·æ±‚ã€‚è¿™å°†è¿”å›æˆ‘ä»¬é’±åŒ…ä¸­çš„Ethæ•°é‡ã€‚åœ¨ä½ è¾“å…¥ä½ çš„Metamaskè´¦æˆ·åœ°å€å¹¶ç‚¹å‡» "å‘é€è¯·æ±‚ "åï¼Œä½ åº”è¯¥çœ‹åˆ°è¿™æ ·çš„å“åº”ã€‚

```js
{"jsonrpc": "2.0", "id": 0, "result": "0xde0b6b3a7640000"}
```

> æ³¨æ„ï¼šè¿™ä¸ªç»“æœæ˜¯ä»¥weiè€Œä¸æ˜¯ethä¸ºå•ä½çš„ã€‚Weiè¢«ç”¨ä½œæœ€å°çš„ä»¥å¤ªåŠé¢é¢ã€‚ä»weiåˆ°ethçš„è½¬æ¢æ˜¯ï¼š1 eth = 10Â¹â¸ weiã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬å°†0xde0b6b3a7640000è½¬æ¢ä¸ºåè¿›åˆ¶ï¼Œæˆ‘ä»¬å¾—åˆ°1*10Â¹â¸ï¼Œç­‰äº1 ethã€‚

å”·! æˆ‘ä»¬çš„å‡é’±éƒ½åœ¨è¿™é‡Œäº†! ğŸ¤‘

### ç¬¬5æ­¥ï¼šå°†Metamaskè¿æ¥åˆ°ä½ çš„ç”¨æˆ·ç•Œé¢

ç°åœ¨æˆ‘ä»¬çš„Metamaské’±åŒ…å·²ç»è®¾ç½®å¥½äº†ï¼Œè®©æˆ‘ä»¬æŠŠæˆ‘ä»¬çš„DAppè¿æ¥åˆ°å®ƒ!

#### connectWalletå‡½æ•°

åœ¨æˆ‘ä»¬çš„interactive.jsæ–‡ä»¶ä¸­ï¼Œè®©æˆ‘ä»¬å®ç°connectWalletå‡½æ•°ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥åœ¨HelloWorld.jsç»„ä»¶ä¸­è°ƒç”¨å®ƒã€‚

è®©æˆ‘ä»¬æŠŠconnectWalletä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹ã€‚

```js
export const connectWallet = async () => {
  if (window.ethereum) {
    try {
      const addressArray = await window.ethereum.request({
        method: "eth_requestAccounts",
      });
      const obj = {
        status: "ğŸ‘†ğŸ½ Write a message in the text-field above.",
        address: addressArray[0],
      };
      return obj;
    } catch (err) {
      return {
        address: "",
        status: "ğŸ˜¥ " + err.message,
      };
    }
  } else {
    return {
      address: "",
      status: (
        <span>
          <p>
            {" "}
            ğŸ¦Š{" "}
            <a target="_blank" href={`https://metamask.io/download.html`}>
              You must install Metamask, a virtual Ethereum wallet, in your
              browser.
            </a>
          </p>
        </span>
      ),
    };
  }
};
```

é‚£ä¹ˆï¼Œè¿™ä¸ªå·¨å¤§çš„ä»£ç å—åˆ°åº•æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ

å—¯ï¼Œé¦–å…ˆï¼Œå®ƒæ£€æŸ¥`window.ethereum`æ˜¯å¦åœ¨ä½ çš„æµè§ˆå™¨ä¸­å¯ç”¨ã€‚

> window.ethereumæ˜¯ç”±Metamaskå’Œå…¶ä»–é’±åŒ…æä¾›å•†æ³¨å…¥çš„å…¨çƒAPIï¼Œå…è®¸ç½‘ç«™è¯·æ±‚ç”¨æˆ·çš„ä»¥å¤ªåŠè´¦æˆ·ã€‚å¦‚æœè¢«æ‰¹å‡†ï¼Œå®ƒå¯ä»¥ä»ç”¨æˆ·è¿æ¥çš„åŒºå—é“¾ä¸­è¯»å–æ•°æ®ï¼Œå¹¶å»ºè®®ç”¨æˆ·ç­¾ç½²ä¿¡æ¯å’Œäº¤æ˜“. è¯·æŸ¥çœ‹[Metamaskæ–‡æ¡£](https://docs.metamask.io/guide/ethereum-provider.html#table-of-contents)ä»¥äº†è§£æ›´å¤šä¿¡æ¯!

å¦‚æœ`window.ethereum`ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€Metamaskæ²¡æœ‰å®‰è£…ã€‚è¿™å°†å¯¼è‡´ä¸€ä¸ªJSONå¯¹è±¡è¢«è¿”å›ï¼Œå…¶ä¸­è¿”å›çš„åœ°å€æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œè€ŒçŠ¶æ€JWXå¯¹è±¡è½¬è¾¾äº†ç”¨æˆ·å¿…é¡»å®‰è£…Metamaskã€‚

ç°åœ¨ï¼Œå¦‚æœwindow.ethereumå­˜åœ¨ï¼Œé‚£ä¹ˆäº‹æƒ…å°±å˜å¾—æœ‰è¶£äº†ã€‚

ä½¿ç”¨try/catchå¾ªç¯ï¼Œæˆ‘ä»¬å°†å°è¯•é€šè¿‡è°ƒç”¨`window.ethereum.request({ method: "eth_requestAccounts" })`è¿æ¥åˆ°Metamaskï¼›è°ƒç”¨æ­¤å‡½æ•°å°†åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€Metamaskï¼Œç”¨æˆ·å°†è¢«æç¤ºå°†ä»–ä»¬çš„é’±åŒ…è¿æ¥åˆ°ä½ çš„dAppã€‚

å¦‚æœç”¨æˆ·é€‰æ‹©äº†è¿æ¥ï¼Œ`method: "eth_requestAccounts"`å°†è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰è¿æ¥åˆ°dAppçš„ç”¨æˆ·çš„è´¦æˆ·åœ°å€ã€‚æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬çš„connectWalletå‡½æ•°å°†è¿”å›ä¸€ä¸ªJSONå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«è¿™ä¸ªæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªåœ°å€ï¼ˆè§ç¬¬9è¡Œï¼‰å’Œä¸€ä¸ªç»Ÿè®¡ä¿¡æ¯ï¼Œæç¤ºç”¨æˆ·å†™ä¸€ä¸ªä¿¡æ¯ç»™æ™ºèƒ½åˆçº¦ã€‚

å¦‚æœç”¨æˆ·æ‹’ç»è¿æ¥ï¼Œé‚£ä¹ˆJSONå¯¹è±¡å°†åŒ…å«ä¸€ä¸ªè¿”å›åœ°å€çš„ç©ºå­—ç¬¦ä¸²å’Œä¸€ä¸ªåæ˜ ç”¨æˆ·æ‹’ç»è¿æ¥çš„çŠ¶æ€æ¶ˆæ¯ã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»å†™å¥½äº†è¿™ä¸ªconnectWalletå‡½æ•°ï¼Œä¸‹ä¸€æ­¥æ˜¯å°†å…¶è°ƒç”¨åˆ°æˆ‘ä»¬çš„HelloWorld.jsç»„ä»¶ã€‚

#### å°†connectWalletå‡½æ•°æ·»åŠ åˆ°ä½ çš„HelloWorld.js UIç»„ä»¶ä¸­

å¯¼èˆªåˆ°HelloWorld.jsä¸­çš„connectWalletPressedå‡½æ•°ï¼Œå¹¶å°†å…¶æ›´æ–°ä¸ºä»¥ä¸‹å†…å®¹ã€‚

```js
const connectWalletPressed = async () => {
  const walletResponse = await connectWallet();
  setStatus(walletResponse.status);
  setWallet(walletResponse.address);
};
```

æ³¨æ„åˆ°æˆ‘ä»¬çš„å¤§éƒ¨åˆ†åŠŸèƒ½æ˜¯å¦‚ä½•ä»interactive.jsæ–‡ä»¶ä¸­æŠ½è±¡å‡ºæ¥ç»™æˆ‘ä»¬çš„HelloWorld.jsç»„ä»¶çš„å—ï¼Ÿè¿™æ˜¯ä¸ºäº†è®©æˆ‘ä»¬ç¬¦åˆM-V-Cçš„èŒƒå¼!

åœ¨connectWalletPressedä¸­ï¼Œæˆ‘ä»¬ç®€å•åœ°å¯¹å¯¼å…¥çš„connectWalletå‡½æ•°è¿›è¡Œç­‰å¾…è°ƒç”¨ï¼Œå¹¶ä½¿ç”¨å…¶å“åº”ï¼Œé€šè¿‡å…¶çŠ¶æ€é’©å­æ›´æ–°æˆ‘ä»¬çš„çŠ¶æ€å’ŒwalletAddresså˜é‡ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä¿å­˜è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼ˆHelloWorld.jså’Œinteractive.jsï¼‰å¹¶æµ‹è¯•ä¸€ä¸‹æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢çš„ç”¨æˆ·ç•Œé¢ã€‚

åœ¨http://localhost:3000/ é¡µé¢ä¸Šæ‰“å¼€ä½ çš„æµè§ˆå™¨ï¼Œç„¶åæŒ‰ä¸‹é¡µé¢å³ä¸Šæ–¹çš„ "è¿æ¥é’±åŒ… "æŒ‰é’®ã€‚

å¦‚æœä½ å®‰è£…äº†Metamaskï¼Œä½ åº”è¯¥è¢«æç¤ºå°†ä½ çš„é’±åŒ…è¿æ¥åˆ°ä½ çš„dAppã€‚æ¥å—è¿æ¥çš„é‚€è¯·ã€‚

æ‚¨åº”è¯¥çœ‹åˆ°é’±åŒ…æŒ‰é’®ç°åœ¨åæ˜ å‡ºæ‚¨çš„åœ°å€å·²è¢«è¿æ¥! Yasssss ğŸ”¥

æ¥ä¸‹æ¥ï¼Œå°è¯•åˆ·æ–°é¡µé¢...è¿™å¾ˆå¥‡æ€ªã€‚æˆ‘ä»¬çš„é’±åŒ…æŒ‰é’®æ­£åœ¨æç¤ºæˆ‘ä»¬è¿æ¥Metamaskï¼Œå°½ç®¡å®ƒå·²ç»è¿æ¥äº†...

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/202210301055541.gif)

é‡æ–°åŠ è½½æ—¶çš„é—®é¢˜é¡µé¢

ç„¶è€Œï¼Œä¸ç”¨æ‹…å¿ƒ! æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°getCurrentWalletConnectedæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼ˆæ˜ç™½å—ï¼Ÿ ğŸ˜…ï¼‰ï¼Œå®ƒå°†æ£€æŸ¥ä¸€ä¸ªåœ°å€æ˜¯å¦å·²ç»è¿æ¥åˆ°æˆ‘ä»¬çš„DAppï¼Œå¹¶ç›¸åº”åœ°æ›´æ–°æˆ‘ä»¬çš„ç”¨æˆ·ç•Œé¢

#### getCurrentWalletConnectedå‡½æ•°

å°† interact.js æ–‡ä»¶ä¸­çš„ getCurrentWalletConnected å‡½æ•°æ›´æ–°ä¸ºä»¥ä¸‹å†…å®¹ã€‚

```js
export const getCurrentWalletConnected = async () => {
  if (window.ethereum) {
    try {
      const addressArray = await window.ethereum.request({
        method: "eth_accounts",
      });
      if (addressArray.length > 0) {
        return {
          address: addressArray[0],
          status: "ğŸ‘†ğŸ½ Write a message in the text-field above.",
        };
      } else {
        return {
          address: "",
          status: "ğŸ¦Š Connect to Metamask using the top right button.",
        };
      }
    } catch (err) {
      return {
        address: "",
        status: "ğŸ˜¥ " + err.message,
      };
    }
  } else {
    return {
      address: "",
      status: (
        <span>
          <p>
            {" "}
            ğŸ¦Š{" "}
            <a target="_blank" href={`https://metamask.io/download.html`}>
              You must install Metamask, a virtual Ethereum wallet, in your
              browser.
            </a>
          </p>
        </span>
      ),
    };
  }
};
```



è¿™æ®µä»£ç ä¸æˆ‘ä»¬åœ¨ä¸Šä¸€æ­¥åˆšåˆšå†™å¥½çš„connectWalletå‡½æ•°éå¸¸ç›¸ä¼¼ã€‚

ä¸»è¦çš„åŒºåˆ«æ˜¯ï¼Œæˆ‘ä»¬æ²¡æœ‰è°ƒç”¨æ–¹æ³•eth_requestAccountsï¼ˆæ‰“å¼€Metamaskè®©ç”¨æˆ·è¿æ¥ä»–ä»¬çš„é’±åŒ…ï¼‰ï¼Œè€Œæ˜¯åœ¨è¿™é‡Œè°ƒç”¨æ–¹æ³•eth_accountsï¼Œå®ƒåªæ˜¯è¿”å›ä¸€ä¸ªåŒ…å«å½“å‰è¿æ¥åˆ°æˆ‘ä»¬dAppçš„Metamaskåœ°å€çš„æ•°ç»„ã€‚

ä¸»è¦çš„åŒºåˆ«æ˜¯ï¼Œæˆ‘ä»¬æ²¡æœ‰è°ƒç”¨æ–¹æ³•eth_requestAccountsï¼Œæ‰“å¼€Metamaskè®©ç”¨æˆ·è¿æ¥ä»–ä»¬çš„é’±åŒ…ï¼Œè€Œæ˜¯åœ¨è¿™é‡Œè°ƒç”¨æ–¹æ³•eth_accountsï¼Œå®ƒåªæ˜¯è¿”å›ä¸€ä¸ªåŒ…å«å½“å‰è¿æ¥åˆ°æˆ‘ä»¬dAppçš„Metamaskåœ°å€çš„æ•°ç»„ã€‚



```js
useEffect(async () => {
    const message = await loadCurrentMessage();
    setMessage(message);
    addSmartContractListener();

    const {address, status} = await getCurrentWalletConnected();
    setWallet(address);
    setStatus(status);

}, []);
```

æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨è°ƒç”¨getCurrentWalletConnectedçš„å“åº”æ¥æ›´æ–°æˆ‘ä»¬çš„walletAddresså’ŒçŠ¶æ€å˜é‡ã€‚

ç°åœ¨ä½ å·²ç»æ·»åŠ äº†è¿™äº›ä»£ç ï¼Œè®©æˆ‘ä»¬è¯•ç€åˆ·æ–°æˆ‘ä»¬çš„æµè§ˆå™¨çª—å£ã€‚

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/202210301056131.gif)

å¾ˆå¥½! è¿™ä¸ªæŒ‰é’®åº”è¯¥è¯´ä½ å·²ç»è¿æ¥ä¸Šäº†ï¼Œå¹¶æ˜¾ç¤ºä½ æ‰€è¿æ¥çš„é’±åŒ…çš„åœ°å€é¢„è§ˆ--å³ä½¿åœ¨ä½ åˆ·æ–°ä¹‹åä¹Ÿæ˜¯å¦‚æ­¤

#### å®ç°addWalletListener

dAppé’±åŒ…è®¾ç½®çš„æœ€åä¸€æ­¥æ˜¯å®ç°é’±åŒ…ç›‘å¬å™¨ï¼Œè¿™æ ·å½“æˆ‘ä»¬çš„é’±åŒ…çŠ¶æ€æ”¹å˜æ—¶ï¼Œæˆ‘ä»¬çš„ç”¨æˆ·ç•Œé¢å°±ä¼šæ›´æ–°ï¼Œä¾‹å¦‚å½“ç”¨æˆ·æ–­å¼€è¿æ¥æˆ–åˆ‡æ¢è´¦æˆ·æ—¶ã€‚

åœ¨ä½ çš„HelloWorld.jsæ–‡ä»¶ä¸­ï¼Œä¿®æ”¹ä½ çš„addWalletListenerå‡½æ•°å¦‚ä¸‹ã€‚

æˆ‘æ‰“èµŒä½ ç”šè‡³ä¸éœ€è¦æˆ‘ä»¬çš„å¸®åŠ©æ¥ç†è§£è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆğŸ˜‰ï¼Œä½†ä¸ºäº†å½»åº•äº†è§£ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿåˆ†è§£å®ƒã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬çš„å‡½æ•°æ£€æŸ¥window.ethereumæ˜¯å¦è¢«å¯ç”¨ï¼ˆå³Metamaskè¢«å®‰è£…ï¼‰ã€‚

å¦‚æœæ²¡æœ‰ï¼Œæˆ‘ä»¬åªéœ€å°†æˆ‘ä»¬çš„çŠ¶æ€å˜é‡è®¾ç½®ä¸ºä¸€ä¸ªJSXå­—ç¬¦ä¸²ï¼Œæç¤ºç”¨æˆ·å®‰è£…Metamaskã€‚

å¦‚æœå®ƒè¢«å¯ç”¨ï¼Œæˆ‘ä»¬åœ¨ç¬¬3è¡Œè®¾ç½®ç›‘å¬å™¨window.ethereum.on("accountsChanged")ï¼Œç›‘å¬Metamaské’±åŒ…çš„çŠ¶æ€å˜åŒ–ï¼Œå…¶ä¸­åŒ…æ‹¬å½“ç”¨æˆ·è¿æ¥ä¸€ä¸ªé¢å¤–çš„å¸æˆ·åˆ°DAppï¼Œåˆ‡æ¢å¸æˆ·ï¼Œæˆ–æ–­å¼€ä¸€ä¸ªå¸æˆ·ã€‚å¦‚æœè‡³å°‘æœ‰ä¸€ä¸ªè´¦æˆ·è¢«è¿æ¥ï¼ŒwalletAddressçŠ¶æ€å˜é‡å°†è¢«æ›´æ–°ä¸ºç›‘å¬å™¨è¿”å›çš„è´¦æˆ·é˜µåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªè´¦æˆ·ã€‚å¦åˆ™ï¼ŒwalletAddressè¢«è®¾ç½®ä¸ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚

æœ€åä½†åŒæ ·é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æˆ‘ä»¬çš„useEffectå‡½æ•°ä¸­è°ƒç”¨å®ƒã€‚

```js
useEffect(async () => {
    const message = await loadCurrentMessage();
    setMessage(message);
    addSmartContractListener();

    const {address, status} = await getCurrentWalletConnected();
    setWallet(address)
    setStatus(status);

    addWalletListener();
}, []);
```



å°±è¿™æ ·äº†! æˆ‘ä»¬å·²ç»æˆåŠŸåœ°å®Œæˆäº†æ‰€æœ‰çš„é’±åŒ…åŠŸèƒ½çš„ç¼–ç¨‹! ç°åœ¨è¿›å…¥æˆ‘ä»¬çš„æœ€åä¸€é¡¹ä»»åŠ¡ï¼šæ›´æ–°å­˜å‚¨åœ¨æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ä¸­çš„æ¶ˆæ¯

### ç¬¬6æ­¥ï¼šå®ç°updateMessageå‡½æ•°

å¥½äº†ï¼Œå®¶äººï¼Œæˆ‘ä»¬å·²ç»åˆ°äº†æœ€åçš„å…³å¤´äº† åœ¨ä½ çš„interactive.jsæ–‡ä»¶çš„updateMessageä¸­ï¼Œæˆ‘ä»¬è¦åšä»¥ä¸‹å·¥ä½œã€‚

ç¡®ä¿æˆ‘ä»¬å¸Œæœ›åœ¨æˆ‘ä»¬çš„æ™ºèƒ½è”ç³»äººä¸­å‘å¸ƒçš„ä¿¡æ¯æ˜¯æœ‰æ•ˆçš„

ä½¿ç”¨Metamaskç­¾ç½²æˆ‘ä»¬çš„äº¤æ˜“

ä»æˆ‘ä»¬çš„HelloWorld.jså‰å°ç»„ä»¶ä¸­è°ƒç”¨è¿™ä¸ªå‡½æ•°

#### è¾“å…¥é”™è¯¯å¤„ç†

è‡ªç„¶åœ°ï¼Œåœ¨å‡½æ•°çš„å¼€å§‹æœ‰æŸç§è¾“å…¥é”™è¯¯å¤„ç†æ˜¯æœ‰æ„ä¹‰çš„ã€‚

å¦‚æœæ²¡æœ‰å®‰è£…Metamaskæ‰©å±•ï¼Œæ²¡æœ‰è¿æ¥é’±åŒ…ï¼ˆå³ä¼ å…¥çš„åœ°å€æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼‰ï¼Œæˆ–è€…æ¶ˆæ¯æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„å‡½æ•°æå‰è¿”å›ã€‚è®©æˆ‘ä»¬ä¸ºupdateMessageæ·»åŠ ä»¥ä¸‹é”™è¯¯å¤„ç†ã€‚

```js
export const updateMessage = async (address, message) => {
  if (!window.ethereum || address === null) {
    return {
      status:
        "ğŸ’¡ Connect your Metamask wallet to update the message on the blockchain.",
    };
  }

  if (message.trim() === "") {
    return {
      status: "âŒ Your message cannot be an empty string.",
    };
  }
};
```

ç°åœ¨ï¼Œå®ƒæœ‰é€‚å½“çš„è¾“å…¥é”™è¯¯å¤„ç†ï¼Œæ˜¯æ—¶å€™é€šè¿‡Metamaskç­¾ç½²äº¤æ˜“äº†

#### ç­¾ç½²æˆ‘ä»¬çš„äº¤æ˜“

å¦‚æœä½ å¯¹ä¼ ç»Ÿçš„web3ä»¥å¤ªåŠäº¤æ˜“å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥å†™çš„ä»£ç å°†éå¸¸ç†Ÿæ‚‰ã€‚åœ¨ä½ çš„è¾“å…¥é”™è¯¯å¤„ç†ä»£ç ä¸‹é¢ï¼Œç»™updateMessageæ·»åŠ ä»¥ä¸‹å†…å®¹ã€‚

```js
//set up transaction parameters
 const transactionParameters = {
    to: contractAddress, // Required except during contract publications.
    from: address, // must match user's active address.
    data: helloWorldContract.methods.update(message).encodeABI(),
  };

//sign the transaction
  try {
    const txHash = await window.ethereum.request({
      method: "eth_sendTransaction",
      params: [transactionParameters],
    });
    return {
      status: (

          âœ…{" "}

            View the status of your transaction on Etherscan!


          â„¹ï¸ Once the transaction is verified by the network, the message will
          be updated automatically.

      ),
    };
  } catch (error) {
    return {
      status: "ğŸ˜¥ " + error.message,
    };
  }
```

è®©æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹å‘ç”Ÿäº†ä»€ä¹ˆã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è®¾ç½®äº†æˆ‘ä»¬çš„äº¤æ˜“å‚æ•°ï¼Œå…¶ä¸­ã€‚

to æŒ‡å®šæ”¶ä»¶äººåœ°å€ï¼ˆæˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ï¼‰ã€‚

from æŒ‡å®šäº¤æ˜“çš„ç­¾ç½²è€…ï¼Œå³æˆ‘ä»¬ä¼ å…¥å‡½æ•°çš„åœ°å€å˜é‡

dataåŒ…å«å¯¹æˆ‘ä»¬çš„Hello Worldæ™ºèƒ½åˆçº¦çš„æ›´æ–°æ–¹æ³•çš„è°ƒç”¨ï¼Œæ¥æ”¶æˆ‘ä»¬çš„messagestringå˜é‡ä½œä¸ºè¾“å…¥ã€‚

ç„¶åï¼Œæˆ‘ä»¬è¿›è¡Œä¸€ä¸ªç­‰å¾…è°ƒç”¨ï¼Œwindow.ethereum.requestï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬è¦æ±‚Metamaskç­¾ç½²äº¤æ˜“ã€‚æ³¨æ„ï¼Œåœ¨ç¬¬11è¡Œå’Œç¬¬12è¡Œï¼Œæˆ‘ä»¬æŒ‡å®šäº†æˆ‘ä»¬çš„ethæ–¹æ³•ï¼Œeth_sendTransactionï¼Œå¹¶ä¼ å…¥æˆ‘ä»¬çš„transactionParametersã€‚

åœ¨è¿™ä¸€ç‚¹ä¸Šï¼ŒMetamaskå°†åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼Œå¹¶æç¤ºç”¨æˆ·ç­¾ç½²æˆ–æ‹’ç»äº¤æ˜“ã€‚

- å¦‚æœäº¤æ˜“æˆåŠŸï¼Œè¯¥å‡½æ•°å°†è¿”å›ä¸€ä¸ªJSONå¯¹è±¡ï¼Œå…¶ä¸­çš„status JSXå­—ç¬¦ä¸²æç¤ºç”¨æˆ·æŸ¥çœ‹Etherscanï¼Œä»¥è·å¾—æ›´å¤šå…³äºä»–ä»¬äº¤æ˜“çš„ä¿¡æ¯ã€‚
- å¦‚æœäº¤æ˜“å¤±è´¥ï¼Œè¯¥å‡½æ•°å°†è¿”å›ä¸€ä¸ªJSONå¯¹è±¡ï¼Œå…¶ä¸­çš„statuså­—ç¬¦ä¸²ä¼šè½¬è¾¾é”™è¯¯ä¿¡æ¯ã€‚

æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬çš„ updateMessage å‡½æ•°åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚

```js
export const updateMessage = async (address, message) => {

  //input error handling
  if (!window.ethereum || address === null) {
    return {
      status:
        "ğŸ’¡ Connect your Metamask wallet to update the message on the blockchain.",
    };
  }

  if (message.trim() === "") {
    return {
      status: "âŒ Your message cannot be an empty string.",
    };
  }

  //set up transaction parameters
  const transactionParameters = {
    to: contractAddress, // Required except during contract publications.
    from: address, // must match user's active address.
    data: helloWorldContract.methods.update(message).encodeABI(),
  };

  //sign the transaction
  try {
    const txHash = await window.ethereum.request({
      method: "eth_sendTransaction",
      params: [transactionParameters],
    });
    return {
      status: (

          âœ…{" "}

            View the status of your transaction on Etherscan!


          â„¹ï¸ Once the transaction is verified by the network, the message will
          be updated automatically.

      ),
    };
  } catch (error) {
    return {
      status: "ğŸ˜¥ " + error.message,
    };
  }
};
```

æœ€åä½†å¹¶éæœ€ä¸é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦å°†updateMessageå‡½æ•°è¿æ¥åˆ°æˆ‘ä»¬çš„HelloWorld.jsç»„ä»¶ã€‚

#### å°†updateMessageè¿æ¥åˆ°HelloWorld.jsçš„å‰å°

æˆ‘ä»¬çš„onUpdatePressedå‡½æ•°åº”è¯¥å¯¹å¯¼å…¥çš„updateMessageå‡½æ•°è¿›è¡Œç­‰å¾…è°ƒç”¨ï¼Œå¹¶ä¿®æ”¹çŠ¶æ€å˜é‡ä»¥åæ˜ æˆ‘ä»¬çš„äº¤æ˜“æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ã€‚

```js
const onUpdatePressed = async () => {
    const { status } = await updateMessage(walletAddress, newMessage);
    setStatus(status);
};
```

è¿™æ˜¯è¶…çº§å¹²å‡€å’Œç®€å•çš„ã€‚ğŸ˜Œ ä½ çŒœæ€ä¹ˆç€......ä½ çš„DAPPå·²ç»å®Œæˆäº†ï¼ï¼ã€‚

è®©æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ "æ›´æ–° "æŒ‰é’®!

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/202210301057159.gif)

### ç¬¬7æ­¥ï¼šåˆ¶ä½œæ‚¨è‡ªå·±çš„è‡ªå®šä¹‰DApp ğŸš€

Woooooï¼Œä½ å·²ç»èµ°åˆ°äº†æœ¬æ•™ç¨‹çš„æœ€å! å›é¡¾ä¸€ä¸‹ï¼Œä½ å­¦ä¼šäº†å¦‚ä½•ã€‚

- å°†Metamaské’±åŒ…è¿æ¥åˆ°ä½ çš„dAppé¡¹ç›®ä¸Š
- ä½¿ç”¨Alchemy Web3 APIä»æ‚¨çš„æ™ºèƒ½åˆçº¦ä¸­è¯»å–æ•°æ®
- ä½¿ç”¨Metamaskç­¾ç½²Ethereumäº¤æ˜“

ç°åœ¨ï¼Œæ‚¨å·²ç»å®Œå…¨æœ‰èƒ½åŠ›åº”ç”¨æœ¬æ•™ç¨‹ä¸­çš„æŠ€èƒ½æ¥æ„å»ºæ‚¨è‡ªå·±çš„è‡ªå®šä¹‰dAppé¡¹ç›®äº† å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·ä¸è¦çŠ¹è±«ï¼Œåœ¨Alchemy Discordä¸­å‘æˆ‘ä»¬å¯»æ±‚å¸®åŠ©ã€‚ğŸ§™â™‚ï¸

## 9ã€å…¶ä»–èµ„æº

æ‚¨è§‰å¾—æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ä»‹ç»å¦‚ä½•ï¼Ÿ

è¿˜æœ‰å¾ˆå¤šä¸œè¥¿è¦å­¦ã€‚ç‰¹åˆ«æ˜¯ï¼Œæ‰å®æŒæ¡ Solidity çš„åŸºç¡€çŸ¥è¯†å¹¶ä½¿ç”¨ä»¥å¤ªåŠä¸­ä¸€äº›æœ€å¸¸è§çš„æ¡†æ¶è¿›è¡Œæ™ºèƒ½åˆçº¦å¼€å‘ä¼šéå¸¸æœ‰ç”¨ã€‚

æˆ‘ä»¬å»ºè®®æ£€æŸ¥ä»¥ä¸‹å·¥å…·ï¼š 

- [Solidity ç¤ºä¾‹ï¼š](https://solidity-by-example.org/)Solidityä¸»è¦åŠŸèƒ½çš„å¿«èŠ‚å¥ç¼–ç æ¼”ç»ƒï¼šæ•°æ®ç±»å‹ã€ç»“æ„ã€ä¿®é¥°ç¬¦å’Œç®€å•çš„åº”ç”¨ç¨‹åºã€‚
- [OpenZeppelin Docsï¼š](https://docs.openzeppelin.com/) ç”¨äºæ„å»ºæ™ºèƒ½åˆçº¦çš„å„ç§æ•™å­¦æ•™ç¨‹å’Œå·¥å…·ï¼Œç‰¹åˆ«æ˜¯æä¾›å¯é‡ç”¨çš„æ¨¡å—åŒ–æ™ºèƒ½åˆçº¦åº“ï¼Œæ‚¨å¯ä»¥å°†å…¶æ”¾å…¥é¡¹ç›®ä¸­ã€‚
- [Scaffold-Ethï¼š](https://github.com/scaffold-eth/scaffold-eth) å›´ç»•å°½å¿«å®æ–½å°å‹ç¼–ç é¡¹ç›®çš„å„ç§ä»¥å¤ªåŠç¼–ç æŒ‘æˆ˜ã€‚

> è¯‘è€…æ³¨ï¼š
> æ–‡ç« ä»£ç è¾ƒå¤šï¼Œå¦‚æœç–‘é—®ï¼Œè¯·æŸ¥çœ‹githubæºç ï¼šhttps://github.com/alchemyplatform/hello-world-part-four-tutorialã€‚
> æ–‡ç« åŸæ–‡é“¾æ¥ï¼šhttps://www.web3.university/tracks/create-a-smart-contract/integrate-your-smart-contract-with-a-frontend

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/my.png)