---
title: Web3ä¹‹è·¯â€”â€” å¦‚ä½•å»ºç«‹ä¸€ä¸ªè´¨.æŠ¼.Dapp
description: null
author: æç•™ç™½
weight: 0
date: 2022-08-23T14:19:12.279Z
lastmod: 2022-08-23T14:19:18.527Z
tags: []
categories:
  - åŒºå—é“¾
  - WEB3.0
featuredImage: https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/20220814204307.png
---

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•å¼€å‘ä¸€ä¸ªå…·æœ‰åˆ©æ¯ç´¯åŠ ã€å‰Šå‡å’Œå­˜æ¬¾/å–æ¬¾åŠŸèƒ½çš„ç®€å•è´¨.æŠ¼. DAppã€‚

åœ¨è¿‡å»è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¾ˆå¤šä¸åŒçš„Solidityå’ŒJavascriptåŸè¯­ï¼Œè¿™äº›åŸè¯­ä¸ºæˆ‘ä»¬æä¾›äº†Web3å¼€å‘çš„åŸºæœ¬æ„ä»¶ã€‚

æˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•ä»å¤´å¼€å§‹ä½¿ç”¨Hardhatï¼Œå»ºç«‹æˆ‘ä»¬è‡ªå·±çš„å‰å°ï¼Œç”šè‡³ç¼–å†™Solidityã€‚

è™½ç„¶æ‰€æœ‰è¿™äº›æŠ€èƒ½å¯¹äºå¸Œæœ›å»ºç«‹åšå®åŸºç¡€çš„å¼€å‘è€…æ¥è¯´éƒ½æ˜¯éå¸¸æœ‰ä»·å€¼çš„ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›å·¥å…·å¯ä»¥å¸®åŠ©æŠ½è±¡å‡ºä¸€äº›å¤æ‚çš„ç¯å¢ƒè®¾ç½®å’Œä¾èµ–å…³ç³»ï¼Œä½¿æ„å»ºè€…å¯ä»¥æ›´å®¹æ˜“åœ°è¿›è¡Œä¿®è¡¥

æˆ‘ä»¬æ¨èçš„è¿™äº›å·¥å…·ä¹‹ä¸€æ˜¯[Scaffold-eth](http://scaffoldeth.io/)!

Scaffold-ethçš„æ ¸å¿ƒæ˜¯ä¸ºä»¥å¤ªåŠä¸Šçš„å¿«é€ŸåŸå‹å¼€å‘æä¾›äº†ä¸€ä¸ªç°æˆçš„å †æ ˆï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿè·å¾—æœ€å…ˆè¿›çš„å·¥å…·æ¥å¿«é€Ÿå­¦ä¹ /äº¤ä»˜åŸºäºä»¥å¤ªåŠçš„dAppã€‚

ä½¿ç”¨Scaffold-ethå’ŒAlchemyï¼Œä½ å¯ä»¥è½»æ¾åœ°åœ¨åŒºå—é“¾ä¸Šåˆæˆå’Œéƒ¨ç½²ä»£ç ã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨[SpeedRunEthereum](https://speedrunethereum.com/)   [Challenge #1](https://speedrunethereum.com/challenge/decentralized-staking)çš„åŸºç¡€ä»£ç ï¼Œå¹¶ä¸”å…±åŒæ„å»ºä¸€ä¸ªç®€å•çš„è´¨.æŠ¼. dAppã€‚

å¦‚æœä½ ä¸ç†Ÿæ‚‰åŠ å¯†è´§å¸è´¨.æŠ¼.ï¼Œå®ƒæœ€å¥½è¢«æ¦‚æ‹¬ä¸ºå°†æŒæœ‰çš„åŠ å¯†è´§å¸é”å®š/å­˜å…¥DeFiåè®®æˆ–æ™ºèƒ½åˆçº¦ä»¥è·å¾—åˆ©æ¯çš„è¿‡ç¨‹ã€‚

è´¨.æŠ¼.åŠ å¯†è´§å¸å·²æˆä¸ºè®¸å¤šDeFiåè®®çš„åŸºçŸ³ï¼Œå¹¶å…è®¸å¼€å‘äººå‘˜åˆ›å»ºå¤æ‚çš„é‡‘èè¡ç”Ÿäº§å“ã€‚

è™½ç„¶å¤§å¤šæ•°DeFiè´¨.æŠ¼.åˆåŒéƒ½éå¸¸å¤æ‚ï¼Œä½†æˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªæœ€åŸºæœ¬çš„åˆåŒæ¥å­¦ä¹ å…³é”®æ¦‚å¿µã€‚

æˆ‘ä»¬å°†ä¸€èµ·å­¦ä¹ ä»¥ä¸‹æœ‰å…³è´¨.æŠ¼.çš„æ„ä»¶ã€‚

1. ç”¨Scaffold-Ethæ„å»º
   - ä¸€èµ·ç ´è§£å‰ç«¯
   - æ‰“é€  Solidity â€œåç«¯â€
2. å°†ETHä»é’±åŒ…è½¬ç§»åˆ°æ™ºèƒ½åˆçº¦ï¼Œåä¹‹äº¦ç„¶
3. åˆ©ç”¨Solidityä¿®æ”¹å™¨

è®©æˆ‘ä»¬ä»äº†è§£Scaffold-Ethçš„å·¥ä½œåŸç†å¼€å§‹å§!

## 1. ä¸‹è½½Scaffold-Eth

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Scaffold-Ethå¼€å‘è€…ç¯å¢ƒæ¥åˆ¶ä½œæˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ï¼Œå¹¶å°†æˆ‘ä»¬çš„å‰ç«¯UIæ”¾åœ¨ä¸€èµ·ã€‚

> åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘æƒ³ä¼ è¾¾å‡ ä¸ªé‡è¦çš„ç»†èŠ‚ï¼Œè®©å¤§å®¶ç‰¢è®°åœ¨å¿ƒ!
>
> Scaffold-Ethåœ¨æŠ½è±¡åŒ–ç¯å¢ƒè®¾ç½®å’Œå‰ç«¯ä¾èµ–æ–¹é¢éå¸¸æ£’ï¼Œè¿™ä½¿å®ƒæˆä¸ºä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ã€‚
>
> è™½ç„¶æœ‰å¾ˆå¤šåŠŸèƒ½æ˜¯ç”±Scaffold-Ethè‡ªåŠ¨å¤„ç†çš„ï¼Œä½†å½“ä½ å¯¹æ•´ä¸ªå¼€å‘è€…ç¯å¢ƒæœ‰äº†æ›´æ‰å®çš„æŒæ¡åï¼Œæ·±å…¥åˆ°ä»£ç ä¸­å»äº†è§£å…¶ä¸­ä¸€äº›åŠŸèƒ½æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Œè¿™ä¸€ç‚¹å¾ˆé‡è¦ã€‚

è®©æˆ‘ä»¬ä»Fork  [SpeedRunEthereum](https://speedrunethereum.com/)çš„ [Challenge #1](https://speedrunethereum.com/challenge/decentralized-staking) çš„åŸºç¡€ä»£ç åº“å¼€å§‹ã€‚

```http
git clone https://github.com/scaffold-eth/scaffold-eth-challenges.git challenge-1-decentralized-staking

cd challenge-1-decentralized-staking

git checkout challenge-1-decentralized-staking

yarn install
```

å¦‚æœä½ å·²ç»æˆåŠŸè·Ÿä¸Šï¼Œä½ å°†èƒ½å¤Ÿåœ¨ä½ çš„åŸºç¡€æ–‡ä»¶ç›®å½•ä¸­å‡ºç°ä¸€ä¸ªåä¸º`challenge-1-decentralized-staking`çš„æ–°æ–‡ä»¶å¤¹ã€‚

åœ¨è¿è¡Œä¸Šè¿°å‘½ä»¤åï¼Œæˆ‘ä»¬ç•™ä¸‹äº†ä¸€ä¸ªå……æ»¡æ–‡ä»¶çš„å¤§æ–‡ä»¶å¤¹ã€‚

å³ä½¿åœ¨ç»§ç»­å­¦ä¹ ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥ç†Ÿæ‚‰Scaffold-Ethä¸­å…³é”®æ–‡ä»¶çš„å­˜å‚¨ä½ç½®ï¼Œè¿™æ ·æˆ‘ä»¬å°±çŸ¥é“åº”è¯¥æŠŠé‡ç‚¹æ”¾åœ¨å“ªé‡Œã€‚

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/20220823214629.png)

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/20220823214643.png)

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä¸»è¦åœ¨`Staker.sol`å’Œ`App.jsx`ä¸Šå·¥ä½œã€‚

## 2. è®¾ç½®ä½ çš„ç¯å¢ƒ

æ¥ä¸‹æ¥ï¼Œä½ éœ€è¦ä¸ºä»¥ä¸‹ä¸‰ä¸ªå‘½ä»¤å»ºç«‹ä¸‰ä¸ªç‹¬ç«‹çš„ç»ˆç«¯ã€‚

å¯åŠ¨ä½ çš„Reactå‰ç«¯ã€‚

```
yarn start
```

å¯åŠ¨ä½ çš„Hardhatåç«¯ã€‚

```
yarn chain
```

ç¼–è¯‘ã€éƒ¨ç½²å’Œå‘å¸ƒä½ çš„package/contractsæ–‡ä»¶ä¸­çš„æ‰€æœ‰åˆåŒã€‚

```
yarn deploy
```

> æ¯å½“ä½ æ›´æ–°ä½ çš„åˆåŒæ—¶ï¼Œè¿è¡Œ`yarn deploy --reset`æ¥ "åˆ·æ–° "Scaffold-Ethä¸­çš„åˆåŒã€‚

å¾ˆå¥½! ç°åœ¨ä½ åº”è¯¥å¯ä»¥åœ¨http://localhost:3000/ï¼Œçœ‹åˆ°è¿™ä¸ªä»“åº“çš„UIå‰å°äº†ã€‚

## 3. ç†Ÿæ‚‰Scaffold-Eth

è™½ç„¶æˆ‘çŸ¥é“ä½ å¾ˆæƒ³å¼€å§‹å†™ä»£ç ï¼Œä½†è¿˜æœ‰ä¸€äº›ç»†èŠ‚éœ€è¦å¤„ç†

åœ¨æˆ‘ä»¬çš„é»˜è®¤è§†å›¾ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ ‡ç­¾--`Staker UI` & `Debug Contracts`ã€‚

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/20220823214655.png)

æ¥å§ï¼Œåœ¨ä½ çš„å‰ç«¯é¡µé¢ä¸Šæ¥å›åˆ‡æ¢ï¼Œçœ‹çœ‹ä¸åŒçš„åŠŸèƒ½ã€‚

`Staker UI`åŒ…å«äº†æ‰€æœ‰æˆ‘ä»¬å°†ä¸»è¦ä¸ä¹‹äº’åŠ¨çš„å‰ç«¯ç»„ä»¶ã€‚

å¦‚æœä½ ç‚¹å‡»æ‰€æä¾›çš„æŒ‰é’®ï¼Œä½ ä¼šå‘ç°å¤§å¤šæ•°æŒ‰é’®è¿˜æ²¡æœ‰å®Œå…¨è¿æ¥èµ·æ¥ï¼Œä½ ä¼šç«‹å³é‡åˆ°é”™è¯¯ã€‚

> çœ‹ä¸€ä¸‹`Staker UI`ã€‚ä½ ä¼šæ³¨æ„åˆ°å®ƒæ˜¯å¦‚æ­¤çš„ç®€é™‹çš„! è¿™å°±æ˜¯æˆ‘ä»¬ä¸»è¦è¦æ”¹å˜çš„ä¸œè¥¿ã€‚

ç”±äºä»¥å¤ªåŠä¸Šçš„ä»»ä½•é“¾ä¸Šäº’åŠ¨éƒ½éœ€è¦testnet ETHï¼Œæ‰€ä»¥ä½ éœ€è¦æœ¬åœ°testnet ETHæ¥å¼€å§‹ç ä»·ã€‚

é¦–å…ˆï¼ŒæŠ“ä½ä½ çš„æœ¬åœ°ä¸»æœºé’±åŒ…åœ°å€ã€‚

ç‚¹å‡»å³ä¸Šè§’çš„ "å¤åˆ¶ "æŒ‰é’®ã€‚

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/20220823214707.png)

æ¥ä¸‹æ¥ï¼Œå‰å¾€å·¦ä¸‹è§’ã€‚ä½ å°†èƒ½å¤Ÿåœ¨è¿™é‡Œè®¿é—®æœ¬åœ°é¾™å¤´ã€‚

- è¦ä¹ˆåœ¨æ‰“å¼€çš„å­—æ®µä¸­å¤åˆ¶/ç²˜è´´ä½ çš„åœ°å€ï¼Œè¦ä¹ˆç‚¹å‡» "é’±åŒ… "å›¾æ ‡
- åœ¨æ‰©å±•è§†å›¾ä¸­ç²˜è´´æ‚¨çš„åœ°å€
- ç»™è‡ªå·±å‘é€ä¸€äº›æµ‹è¯•ETH

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/20220823214732.png)

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/20220823214739.png)

åœ¨ä¸ºä½ çš„æœ¬åœ°é’±åŒ…å……å€¼åï¼Œä½ å°±å¯ä»¥ä¸ä½ çš„åˆçº¦è¿›è¡Œäº’åŠ¨äº†

ç¬¬äºŒä¸ªæ ‡ç­¾ï¼Œ`Debug Contracts`ï¼Œæ˜¯å¦ä¸€ä¸ªå‰ç«¯æ˜¾ç¤ºï¼Œå®ƒåŒ…å«äº†Scaffold-Ethçš„ä¸€ä¸ªè¶…çº§å¤§åŠŸèƒ½ï¼åœ¨è¿™ä¸ªæ ‡ç­¾ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°ä½ çš„åˆåŒã€‚

ä¸€æ—¦ä½ `yarn deploy`ä½ çš„åˆçº¦ï¼Œå¹¶é…ç½®å®ƒæ­£ç¡®åœ°è¯»å–åˆçº¦æ•°æ®ï¼Œå®ƒå°†è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªè£¸éœ²çš„UIï¼Œå…è®¸ä½ ä¸ä½ çš„åˆçº¦åŠŸèƒ½äº’åŠ¨ã€‚

ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦è¯»å–å’Œå†™å…¥ä¿¡æ¯ï¼Œåªéœ€æ”¾å…¥å‚æ•°å¹¶ç‚¹å‡» "å‘é€"ã€‚æœ‰äº†Scaffold-Ethï¼Œæˆ‘ä»¬ä¸éœ€è¦åªä½¿ç”¨CLIå‘½ä»¤ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªæ›´ç›´è§‚çš„åŸå‹è®¾è®¡æ–¹å¼ã€‚

> å¦‚æœä½ æƒ³åœ¨`Debug Contracts` æ ‡ç­¾é¡µä¸­å­˜å‚¨å’ŒæŸ¥çœ‹ä¸€ä¸ªå˜é‡ï¼Œè¯·ç¡®ä¿å°†è¯¥å˜é‡è®¾ç½®ä¸ºpublic!

æ£’æäº†!

ç°åœ¨æˆ‘ä»¬å·²ç»ç†Ÿæ‚‰äº†Scaffold-Ethï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ·±å…¥åœ°ç ”ç©¶ä»£ç äº†ã€‚

## 4. æ½œå…¥Solidity

çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„`Staker.sol`æ–‡ä»¶ï¼Œæˆ‘ä»¬å‘ç°æˆ‘ä»¬æœ‰ä¸€ä¸ªç›¸å½“ç©ºçš„Solidityæ–‡ä»¶ï¼Œé‡Œé¢æœ‰ä¸€å †æ³¨é‡Šï¼Œè¯´æ˜éœ€è¦å¡«å†™çš„å†…å®¹ã€‚

ç”±äºæ•™ç¨‹åç¦»äº†Scaffold-Ethçš„ Challenge #1ï¼Œæˆ‘ä»¬å¯ä»¥å¿½ç•¥è¿™äº›æ³¨é‡Šï¼Œä»ä»¥ä¸‹ä»£ç å¼€å§‹ã€‚

```solidity
pragma solidity >=0.6.0 <0.7.0;

import "hardhat/console.sol";
import "./ExampleExternalContract.sol";

contract Staker {
  ExampleExternalContract public exampleExternalContract;
  
  constructor(address exampleExternalContractAddress) public {
      exampleExternalContract = ExampleExternalContract(exampleExternalContractAddress);
  }
  
}
```

### é¡¹ç›®å‚æ•°

åœ¨å†™å‡ºæˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ä»£ç ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬æœŸæœ›æˆ‘ä»¬çš„è´¨.æŠ¼.DAppå¦‚ä½•å·¥ä½œ

1. ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬åªå¸Œæœ›æœ‰ä¸€ä¸ªç”¨æˆ·ä¸æˆ‘ä»¬çš„è´¨.æŠ¼.DAppäº’åŠ¨
2. æˆ‘ä»¬éœ€è¦èƒ½å¤Ÿä»Stakeråˆçº¦ä¸­å­˜æ¬¾å’Œå–æ¬¾ã€‚
   - è´¨.æŠ¼.æ˜¯ä¸€ä¸ªä¸€æ¬¡æ€§çš„è¡Œä¸ºï¼Œè¿™æ„å‘³ç€ä¸€æ—¦æˆ‘ä»¬è´¨.æŠ¼.ï¼Œå°±ä¸èƒ½å†é‡æ–°è´¨.æŠ¼.ã€‚
   - ä»åˆçº¦ä¸­å–æ¬¾ä¼šç§»é™¤æ•´ä¸ªæœ¬é‡‘ä½™é¢å’Œä»»ä½•åº”è®¡åˆ©æ¯
3. Stakeråˆçº¦çš„åˆ©æ¯æ”¯ä»˜ç‡ä¸ºæ¯ç§’é’Ÿ0.1ä¸ªETHï¼Œå­˜å…¥çš„ETHæœ‰èµ„æ ¼è·å¾—åˆ©æ¯ç´¯ç§¯ã€‚
4. åˆåŒéƒ¨ç½²åï¼ŒStakeråˆåŒåº”è¯¥ä»Hh2æ—¶é—´æˆ³è®¡æ•°å™¨å¼€å§‹ã€‚ç¬¬ä¸€ä¸ªæœŸé™åº”è®¾ç½®ä¸º2åˆ†é’Ÿï¼Œç¬¬äºŒä¸ªæœŸé™è®¾ç½®ä¸º4åˆ†é’Ÿ
   - 2åˆ†é’Ÿçš„æœŸé™å†³å®šäº†é’‰å­æˆ·èƒ½å¤Ÿå­˜å…¥èµ„é‡‘çš„æ—¶æœŸã€‚(åœ¨t=0åˆ†é’Ÿå’Œt=2åˆ†é’Ÿä¹‹é—´ï¼Œè´¨.æŠ¼.ç”¨æˆ·å¯ä»¥å­˜æ¬¾)
   - ä»å­˜å…¥èµ„é‡‘åˆ°2åˆ†é’ŸæœŸé™ä¹‹é—´å‘ç”Ÿçš„æ‰€æœ‰åŒºå—éƒ½æ˜¯æœ‰æ•ˆçš„åº”è®¡åˆ©æ¯ã€‚
   - åœ¨2åˆ†é’Ÿçš„ææ¬¾æœŸé™è¿‡åï¼Œè´¨.æŠ¼.ç”¨æˆ·å¯ä»¥æå–å…¨éƒ¨æœ¬é‡‘ä½™é¢å’Œä»»ä½•åº”è®¡åˆ©æ¯ï¼Œç›´åˆ°4åˆ†é’Ÿçš„æœŸé™åˆ°æ¥ã€‚
   - åœ¨é¢å¤–çš„2åˆ†é’Ÿææ¬¾çª—å£è¿‡åï¼Œç”¨æˆ·è¢«é˜»æ­¢æå–ä»–ä»¬çš„èµ„é‡‘ï¼Œå› ä¸ºä»–ä»¬å·²ç»è¶…æ—¶äº†ã€‚
5. å¦‚æœè´¨.æŠ¼.ç”¨æˆ·è¿˜æœ‰èµ„é‡‘ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨æœ€åä¸€ä¸ªå‡½æ•°ï¼Œå°†èµ„é‡‘ "é”å®š "åœ¨å·²ç»é¢„è£…åœ¨Scaffold-Ethç¯å¢ƒä¸­çš„å¤–éƒ¨åˆåŒä¸­ï¼Œå³ExampleExternalContract.solã€‚

> è™½ç„¶ä¸Šé¢åˆ—å‡ºçš„è´¨.æŠ¼.å‚æ•°å¯èƒ½çœ‹èµ·æ¥æœ‰ç‚¹å¤æ‚ï¼Œä½†è®¸å¤šç°å®ç”Ÿæ´»ä¸­çš„è´¨.æŠ¼.dAppséƒ½æœ‰ç±»ä¼¼çš„åŸºå…ƒï¼Œç”¨æˆ·æœ‰ä¸€ä¸ªæœ‰é™çš„å­˜æ¬¾å’Œææ¬¾æœŸã€‚
>
> è€Œä¸”ï¼Œè®¸å¤šDAppså°†æŠ‘åˆ¶ "éç”Ÿäº§æ€§ "èµ„æœ¬ï¼Œè¿™äº›èµ„æœ¬åœ¨è´¨.æŠ¼.æœŸç»“æŸååªæ˜¯é—²ç½®åœ¨é‚£é‡Œã€‚
>
> æœ‰æ—¶ï¼ŒDeFiåè®®ç”šè‡³å¯èƒ½åœ¨ç­‰å¾…æœŸç»“æŸåå¸æ”¶æœªä»˜çš„å­˜æ¬¾ï¼Œè¿™ä¸æˆ‘ä»¬åœ¨æ•™ç¨‹ä¸­æ‰€è¯´çš„æœ€åä¸€ä¸ªå‚æ•°ç±»ä¼¼ã€‚

### Solidity Mappingss

åœ¨æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ä¸­ï¼Œæˆ‘ä»¬å°†éœ€è¦ä¸¤ä¸ªæ˜ å°„æ¥å¸®åŠ©æˆ‘ä»¬å­˜å‚¨ä¸€äº›æ•°æ®ã€‚

ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›ä¸œè¥¿æ¥è·Ÿè¸ªã€‚

1. æœ‰å¤šå°‘ETHè¢«å­˜å…¥åˆçº¦ä¸­
2. å­˜æ¬¾å‘ç”Ÿçš„æ—¶é—´

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°è¿™ä¸€ç›®æ ‡ã€‚

```javascript
mapping(address => uint256) public balances; 
mapping(address => uint256) public depositTimestamps;
```

### å…¬å…±å˜é‡

æ ¹æ®ä¸Šé¢åˆ—å‡ºçš„[å‡†åˆ™](https://docs.alchemy.com/docs/how-to-build-a-staking-dapp#project-parameters)ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€äº›ä¸åŒçš„å˜é‡ã€‚

```solidity
uint256 public constant rewardRatePerSecond = 0.1 ether; 
uint256 public withdrawalDeadline = block.timestamp + 120 seconds; 
uint256 public claimDeadline = block.timestamp + 240 seconds; 
uint256 public currentBlock = 0;
```

å¥–åŠ±ç‡è®¾å®šäº†è´¨.æŠ¼.æœ¬é‡‘çš„ETHçš„å‘æ”¾åˆ©ç‡ã€‚

ææ¬¾å’Œç´¢èµ”çš„æœ€åæœŸé™å¸®åŠ©æˆ‘ä»¬è®¾å®šè´¨.æŠ¼.æœºåˆ¶å¼€å§‹/ç»“æŸçš„æœ€åæœŸé™ã€‚

æœ€åï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå˜é‡ï¼Œç”¨æ¥ä¿å­˜å½“å‰åŒºå—ã€‚

> æˆ‘ä»¬ä½¿ç”¨block.timestamp + XXX secondsæ¥åˆ›å»ºæœ€åæœŸé™ï¼Œæ­£å¥½æ˜¯æˆ‘ä»¬çš„åˆçº¦å¯åŠ¨åçš„XXXç§’ã€‚ä½œä¸ºä¸€ç§è®¡æ—¶æœºåˆ¶ï¼Œè¿™è‚¯å®šæœ‰ç‚¹ "å¤©çœŸ"ï¼›ä½ èƒ½æƒ³å‡ºæ›´å¥½çš„æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œä¾‹å¦‚ï¼Œå®ƒæ›´å…·æœ‰é€šç”¨æ€§ï¼Ÿ

### äº‹ä»¶

å°½ç®¡æˆ‘ä»¬ä¸ä¼šå°†äº‹ä»¶æ¨é€åˆ°æˆ‘ä»¬çš„å‰ç«¯ï¼Œä½†æˆ‘ä»¬ä»ç„¶åº”è¯¥ç¡®ä¿æˆ‘ä»¬åœ¨åˆåŒçš„å…³é”®éƒ¨åˆ†å‘å‡ºäº‹ä»¶ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬ä¿æŒæœ€ä½³çš„ç¼–ç¨‹å®è·µã€‚

```javascript
event Stake(address indexed sender, uint256 amount); 
event Received(address, uint); 
event Execute(address indexed sender, uint256 amount);
```

ç°åœ¨æˆ‘ä»¬å·²ç»é”å®šäº†å…³é”®å‚æ•°/å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­åˆ¶ä½œæˆ‘ä»¬å°†åœ¨æ•™ç¨‹ä¸­ä½¿ç”¨çš„å…·ä½“å‡½æ•°ã€‚

### åªè¯»çš„æ—¶é—´å‡½æ•°

æ­£å¦‚é¡¹ç›®å‚æ•°ä¸­æ‰€è¿°ï¼Œè®¸å¤šä¸åŒçš„è´¨.æŠ¼.DAppçš„åŠŸèƒ½éƒ½å—åˆ¶äº "æ—¶é—´é”"ï¼Œåœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹å¯ç”¨/ç¦æ­¢æŸäº›è¡ŒåŠ¨ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªä¸åŒçš„åŠŸèƒ½æ¥ç®¡ç†ææ¬¾çª—å£çš„å¼€å§‹å’Œç»“æŸã€‚

```javascript
  function withdrawalTimeLeft() public view returns (uint256 withdrawalTimeLeft) {
    if( block.timestamp >= withdrawalDeadline) {
      return (0);
    } else {
      return (withdrawalDeadline - block.timestamp);
    }
  }

  function claimPeriodLeft() public view returns (uint256 claimPeriodLeft) {
    if( block.timestamp >= claimDeadline) {
      return (0);
    } else {
      return (claimDeadline - block.timestamp);
    }
  }
```

è¿™ä¸¤ä¸ªå‡½æ•°åœ¨è®¾è®¡ä¸Šå…¶å®éƒ½éå¸¸ç†Ÿæ‚‰ã€‚

å®ƒä»¬éƒ½æœ‰ä¸€ä¸ªæ ‡å‡†çš„if -> elseè¯­å¥ã€‚

æ¡ä»¶åªæ˜¯æ£€æŸ¥å½“å‰æ—¶é—´æ˜¯å¦å¤§äºæˆ–å°äº[å…¬å…±å˜é‡éƒ¨åˆ†](https://docs.alchemy.com/docs/how-to-build-a-staking-dapp#public-variables)è§„å®šçš„æœ€åæœŸé™ã€‚

å¦‚æœå½“å‰æ—¶é—´å¤§äºé¢„å…ˆå®‰æ’çš„æœ€åæœŸé™ï¼Œæˆ‘ä»¬å°±çŸ¥é“æœ€åæœŸé™å·²è¿‡ï¼Œå¹¶è¿”å›0ä»¥è¡¨ç¤º "çŠ¶æ€å˜åŒ– "å·²ç»å‘ç”Ÿã€‚

å¦åˆ™ï¼Œæˆ‘ä»¬åªæ˜¯è¿”å›åœ¨æœ€åæœŸé™åˆ°æ¥ä¹‹å‰çš„å‰©ä½™æ—¶é—´ã€‚

### ä¿®æ”¹å™¨

å¯¹äºä¸€ä¸ªæ›´æ·±å…¥çš„ä¿®æ”¹å™¨çš„ä¾‹å­ï¼Œè¯·çœ‹ [Solidity By Example](https://solidity-by-example.org/function-modifier)ã€‚

ç®€è€Œè¨€ä¹‹ï¼ŒSolidity ä¿®æ”¹å™¨æ˜¯å¯ä»¥åœ¨å‡½æ•°è°ƒç”¨ä¹‹å‰å’Œ/æˆ–ä¹‹åè¿è¡Œçš„ä»£ç ç‰‡æ®µã€‚

è™½ç„¶å®ƒä»¬æœ‰è®¸å¤šä¸åŒçš„ç”¨é€”ï¼Œä½†æœ€å¸¸è§å’Œæœ€åŸºæœ¬çš„ç”¨ä¾‹ä¹‹ä¸€æ˜¯åœ¨ç‰¹å®šæ¡ä»¶æœªå®Œå…¨æ»¡è¶³çš„æƒ…å†µä¸‹é™åˆ¶å¯¹æŸäº›åŠŸèƒ½çš„è®¿é—®ã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ç²¾ç¡®åœ°ä½¿ç”¨ä¿®æ”¹å™¨æ¥å¸®åŠ©å¯¹å…³é”®åŠŸèƒ½è¿›è¡ŒæŠŠå…³ï¼Œè¿™äº›åŠŸèƒ½å†³å®šäº†æˆ‘ä»¬çš„å…¥è‚¡ã€ææ¬¾å’Œè¿”è¿˜åŠŸèƒ½ã€‚

ä¸‹é¢æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„ä¸‰ä¸ªä¿®æ”¹å™¨ã€‚

```javascript
  modifier withdrawalDeadlineReached( bool requireReached ) {
    uint256 timeRemaining = withdrawalTimeLeft();
    if( requireReached ) {
      require(timeRemaining == 0, "Withdrawal period is not reached yet");
    } else {
      require(timeRemaining > 0, "Withdrawal period has been reached");
    }
    _;
  }

  modifier claimDeadlineReached( bool requireReached ) {
    uint256 timeRemaining = claimPeriodLeft();
    if( requireReached ) {
      require(timeRemaining == 0, "Claim deadline is not reached yet");
    } else {
      require(timeRemaining > 0, "Claim deadline has been reached");
    }
    _;
  }

  modifier notCompleted() {
    bool completed = exampleExternalContract.completed();
    require(!completed, "Stake already completed!");
    _;
  }
```

ä¿®æ”¹å™¨ `withdrawalDeadlineReached(bool requireReached) `&` claimDeadlineReached(bool requireReached) `éƒ½æ¥å—ä¸€ä¸ªå¸ƒå°”å‚æ•°ï¼Œå¹¶æ£€æŸ¥ä»¥ç¡®ä¿å…¶å„è‡ªçš„æœ€åæœŸé™ä¸ºçœŸæˆ–å‡ã€‚

ä¿®æ”¹å™¨`notCompleted()`çš„æ“ä½œæ–¹å¼ç±»ä¼¼ï¼Œä½†å®é™…ä¸Šå®ƒçš„æ€§è´¨æ›´å¤æ‚ä¸€ç‚¹ï¼Œå°½ç®¡å®ƒåŒ…å«çš„ä»£ç è¡Œæ•°æ›´å°‘ã€‚

å®ƒå®é™…ä¸Šæ˜¯ä»Stakerå¤–éƒ¨çš„åˆåŒä¸­è°ƒç”¨ä¸€ä¸ªå‡½æ•°` completed()`ï¼Œå¹¶æ£€æŸ¥å®ƒçš„è¿”å›å€¼æ˜¯çœŸè¿˜æ˜¯å‡ï¼Œä»¥ç¡®è®¤è¯¥æ ‡å¿—æ˜¯å¦è¢«åˆ‡æ¢ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨æ¥ä¸‹æ¥çš„å‡ ä¸ªå‡½æ•°ä¸Šå®ç°æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ä¿®æ”¹å™¨ï¼Œç”¨é—¸é—¨é™åˆ¶è®¿é—®ã€‚

### å­˜æ¬¾/è´¨.æŠ¼.åŠŸèƒ½

åœ¨æˆ‘ä»¬çš„å…¥é‡‘å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å…ˆå‰åˆ›å»ºçš„ä¿®æ”¹å™¨ï¼Œå°†`withdrawingDeadlineReached()`ä¸­çš„å‚æ•°è®¾ç½®ä¸ºfalseï¼Œå°†`claimDeadlineReached()`è®¾ç½®ä¸ºfalseï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¸Œæœ›è¿™ä¸¤ä¸ªæœŸé™å·²ç»è¿‡å»ã€‚

```javascript
  // Stake function for a user to stake ETH in our contract
  
  function stake() public payable withdrawalDeadlineReached(false) claimDeadlineReached(false) {
    balances[msg.sender] = balances[msg.sender] + msg.value;
    depositTimestamps[msg.sender] = block.timestamp;
    emit Stake(msg.sender, msg.value);
  }
```

è¯¥å‡½æ•°çš„å…¶ä½™éƒ¨åˆ†åœ¨ä¸€ä¸ªå…¸å‹çš„ "å­˜æ¬¾ "åœºæ™¯ä¸­æ˜¯ç›¸å½“æ ‡å‡†çš„ï¼Œæˆ‘ä»¬çš„ä½™é¢æ˜ å°„è¢«æ›´æ–°ä»¥åŒ…æ‹¬é€å…¥çš„èµ„é‡‘ã€‚

æˆ‘ä»¬è¿˜ç”¨å­˜æ¬¾çš„å½“å‰æ—¶é—´æ¥è®¾ç½®æˆ‘ä»¬çš„å­˜æ¬¾æ—¶é—´æˆ³ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ä»¥åçš„åˆ©æ¯è®¡ç®—ä¸­è®¿é—®è¿™ä¸ªå­˜å‚¨å€¼ã€‚

### ææ¬¾åŠŸèƒ½

åœ¨æˆ‘ä»¬çš„å–æ¬¾å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å†æ¬¡ä½¿ç”¨å…ˆå‰åˆ›å»ºçš„ä¿®æ”¹å™¨ï¼Œä½†è¿™æ¬¡æˆ‘ä»¬å¸Œæœ›`drawalDeadlineReached()`ä¸ºçœŸï¼Œ `claimDeadlineReached()`ä¸ºå‡ã€‚

è¿™ç»„ä¿®æ”¹å™¨/å‚æ•°æ„å‘³ç€æˆ‘ä»¬å¤„äºææ¬¾çª—å£çš„æœ€ä½³ä½ç½®ï¼Œå› ä¸ºææ¬¾æ—¶é—´åˆ°äº†ï¼Œä¸ä¼šæœ‰ä»»ä½•å¤„ç½šï¼Œè€Œä¸”æˆ‘ä»¬è¿˜èƒ½å¾—åˆ°åˆ©æ¯ã€‚

```solidity
  /*
  Withdraw function for a user to remove their staked ETH inclusive
  of both the principle balance and any accrued interest
  */
  
  function withdraw() public withdrawalDeadlineReached(true) claimDeadlineReached(false) notCompleted{
    require(balances[msg.sender] > 0, "You have no balance to withdraw!");
    uint256 individualBalance = balances[msg.sender];
    uint256 indBalanceRewards = individualBalance + ((block.timestamp-depositTimestamps[msg.sender])*rewardRatePerBlock);
    balances[msg.sender] = 0;

    // Transfer all ETH via call! (not transfer) cc: https://solidity-by-example.org/sending-ether
    (bool sent, bytes memory data) = msg.sender.call{value: indBalanceRewards}("");
    require(sent, "RIP; withdrawal failed :( ");
  }
```

è¯¥å‡½æ•°çš„å…¶ä½™éƒ¨åˆ†åšäº†å‡ ä¸ªé‡è¦æ­¥éª¤ã€‚

1. å®ƒæ£€æŸ¥ä»¥ç¡®ä¿è¯•å›¾æå–ETHçš„äººå®é™…ä¸Šæœ‰ä¸€ä¸ªéé›¶çš„è‚¡ä»½ã€‚
2. å®ƒé€šè¿‡è®¡ç®—ä»å­˜æ¬¾åˆ°å–æ¬¾çš„åŒºå—æ•°ï¼Œå¹¶ä¹˜ä»¥æˆ‘ä»¬çš„åˆ©æ¯å¸¸æ•°ï¼Œæ¥è®¡ç®—æ¬ ä¸‹çš„ETHçš„åˆ©æ¯é‡‘é¢ã€‚
3. å®ƒå°†ç”¨æˆ·çš„ä½™é¢è´¨.æŠ¼.ETHè®¾ä¸º0ï¼Œè¿™æ ·å°±ä¸ä¼šå‘ç”Ÿé‡å¤è®¡ç®—ã€‚
4. å®ƒå°†ETHä»æ™ºèƒ½åˆçº¦è½¬ç§»å›ç”¨æˆ·çš„é’±åŒ…ã€‚

### æ‰§è¡Œè¿”è¿˜åŠŸèƒ½

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¸Œæœ› `claimDeadlineReached() `ä¸ºçœŸï¼Œå› ä¸ºéç”Ÿäº§æ€§èµ„é‡‘çš„è¿”è¿˜åªèƒ½åœ¨4åˆ†é’Ÿåå‘ç”Ÿã€‚

åŒæ ·åœ°ï¼Œæˆ‘ä»¬å¸Œæœ›`notCompleted`ä¸ºçœŸï¼Œå› ä¸ºè¿™ä¸ªDAppåªè®¾è®¡ä¸ºå•ä¸€ç”¨é€”ã€‚

```solidity
  /*
  Allows any user to repatriate "unproductive" funds that are left in the staking contract
  past the defined withdrawal period
  */
  
  function execute() public claimDeadlineReached(true) notCompleted {
    uint256 contractBalance = address(this).balance;
    exampleExternalContract.complete{value: address(this).balance}();
  }
```

å…¶ä½™çš„åŠŸèƒ½ã€‚

1. æŠ“å–Stakeråˆçº¦ä¸­çš„ETHçš„å½“å‰ä½™é¢
2. å°†ETHå‘é€åˆ°repoçš„exampleExternalContractä¸­ã€‚

å¦‚æœä½ åˆ°ç›®å‰ä¸ºæ­¢ä¸€ç›´è·Ÿç€Solidityèµ°ï¼Œä½ çš„Staker.solåº”è¯¥æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ã€‚

```solidity
// SPDX-License-Identifier: MIT
pragma solidity 0.8.4;

import "hardhat/console.sol";
import "./ExampleExternalContract.sol";

contract Staker {

  ExampleExternalContract public exampleExternalContract;

  mapping(address => uint256) public balances;
  mapping(address => uint256) public depositTimestamps;

  uint256 public constant rewardRatePerSecond = 0.1 ether;
  uint256 public withdrawalDeadline = block.timestamp + 120 seconds;
  uint256 public claimDeadline = block.timestamp + 240 seconds;
  uint256 public currentBlock = 0;

  // Events
  event Stake(address indexed sender, uint256 amount);
  event Received(address, uint);
  event Execute(address indexed sender, uint256 amount);

  // Modifiers
  /*
  Checks if the withdrawal period has been reached or not
  */
  modifier withdrawalDeadlineReached( bool requireReached ) {
    uint256 timeRemaining = withdrawalTimeLeft();
    if( requireReached ) {
      require(timeRemaining == 0, "Withdrawal period is not reached yet");
    } else {
      require(timeRemaining > 0, "Withdrawal period has been reached");
    }
    _;
  }

  /*
  Checks if the claim period has ended or not
  */
  modifier claimDeadlineReached( bool requireReached ) {
    uint256 timeRemaining = claimPeriodLeft();
    if( requireReached ) {
      require(timeRemaining == 0, "Claim deadline is not reached yet");
    } else {
      require(timeRemaining > 0, "Claim deadline has been reached");
    }
    _;
  }

  /*
  Requires that the contract only be completed once!
  */
  modifier notCompleted() {
    bool completed = exampleExternalContract.completed();
    require(!completed, "Stake already completed!");
    _;
  }

  constructor(address exampleExternalContractAddress){
      exampleExternalContract = ExampleExternalContract(exampleExternalContractAddress);
  }

  // Stake function for a user to stake ETH in our contract
  function stake() public payable withdrawalDeadlineReached(false) claimDeadlineReached(false){
    balances[msg.sender] = balances[msg.sender] + msg.value;
    depositTimestamps[msg.sender] = block.timestamp;
    emit Stake(msg.sender, msg.value);
  }

  /*
  Withdraw function for a user to remove their staked ETH inclusive
  of both principal and any accrued interest
  */
  function withdraw() public withdrawalDeadlineReached(true) claimDeadlineReached(false) notCompleted{
    require(balances[msg.sender] > 0, "You have no balance to withdraw!");
    uint256 individualBalance = balances[msg.sender];
    uint256 indBalanceRewards = individualBalance + ((block.timestamp-depositTimestamps[msg.sender])*rewardRatePerBlock);
    balances[msg.sender] = 0;

    // Transfer all ETH via call! (not transfer) cc: https://solidity-by-example.org/sending-ether
    (bool sent, bytes memory data) = msg.sender.call{value: indBalanceRewards}("");
    require(sent, "RIP; withdrawal failed :( ");
  }

  /*
  Allows any user to repatriate "unproductive" funds that are left in the staking contract
  past the defined withdrawal period
  */
  function execute() public claimDeadlineReached(true) notCompleted {
    uint256 contractBalance = address(this).balance;
    exampleExternalContract.complete{value: address(this).balance}();
  }

  /*
  READ-ONLY function to calculate the time remaining before the minimum staking period has passed
  */
  function withdrawalTimeLeft() public view returns (uint256 withdrawalTimeLeft) {
    if( block.timestamp >= withdrawalDeadline) {
      return (0);
    } else {
      return (withdrawalDeadline - block.timestamp);
    }
  }

  /*
  READ-ONLY function to calculate the time remaining before the minimum staking period has passed
  */
  function claimPeriodLeft() public view returns (uint256 claimPeriodLeft) {
    if( block.timestamp >= claimDeadline) {
      return (0);
    } else {
      return (claimDeadline - block.timestamp);
    }
  }

  /*
  Time to "kill-time" on our local testnet
  */
  function killTime() public {
    currentBlock = block.timestamp;
  }

  /*
  \Function for our smart contract to receive ETH
  cc: https://docs.soliditylang.org/en/latest/contracts.html#receive-ether-function
  */
  receive() external payable {
      emit Received(msg.sender, msg.value);
  }

}

```

## 5. è¿›å…¥å‰å°

å¤ªæ£’äº†! æˆ‘ä»¬åˆšåˆšç»å†äº†ä¸€å †Solidityã€‚å½“æ¶‰åŠåˆ°å‰ç«¯æ˜¾ç¤ºæ—¶ï¼ŒScaffold-Ethè¯•å›¾è®©äº‹æƒ…å˜å¾—ç®€å•è€Œç¾å¥½ã€‚å®ƒåŒ…å«äº†å¾ˆå¤šä¸åŒçš„ååº”ç»„ä»¶ï¼Œä¸ºç”¨æˆ·æä¾›äº†ä½ä»£ç çš„è§£å†³æ–¹æ¡ˆï¼Œä»¥å®ç°ä»¤äººæ•¬ç•çš„UIï¼æˆ‘é¼“åŠ±ä½ ç©ç©è¿™äº›ç»„ä»¶ã€‚æˆ‘é¼“åŠ±ä½ ç©ç©ä¸åŒçš„ç»„ä»¶ï¼Œä½†ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬å°†åœ¨spartanæ–¹é¢å­¦ä¹ æ›´å¤šã€‚

çœ‹çœ‹æˆ‘ä»¬çš„App.jsxæ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯åœ¨[é“¾æ¥573é™„è¿‘çš„ä»£ç å—](https://github.com/scaffold-eth/scaffold-eth/blob/challenge-1-decentralized-staking/packages/react-app/src/App.jsx#L573)ï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªä»£ç å—ï¼Œç”¨äºä»æˆ‘ä»¬çš„Solidityåˆçº¦ä¸­æ•è·å‘å°„çš„äº‹ä»¶ï¼Œå¹¶å°†å…¶æ˜¾ç¤ºä¸ºä¸€ä¸ªåˆ—è¡¨ã€‚

æœ‰æ•ˆåœ°ï¼Œå®ƒå…è®¸æˆ‘ä»¬è®°å½•ä»æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦å‘å°„çš„ä¸åŒè¡ŒåŠ¨ï¼Œè§£æå­˜å‚¨çš„ä¿¡æ¯ï¼Œç„¶åç›´è§‚åœ°å…è®¸dAppç”¨æˆ·æŸ¥çœ‹ä»–ä»¬çš„é“¾ä¸Šå†å²ã€‚

è™½ç„¶æˆ‘ä»¬å°†é€šè¿‡åœ¨Solidityåˆçº¦ä¸­å‘å°„äº‹ä»¶æ¥å®è·µè‰¯å¥½çš„ç¼–ç¨‹æ ‡å‡†ï¼Œä½†è¿™æ¬¡ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†åœ¨å‰ç«¯å¿½ç•¥äº‹ä»¶ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å®Œå…¨åˆ é™¤è¿™ä¸ªä»£ç å—ã€‚

å¦‚æœä½ çœ‹ä¸€ä¸‹ä½ çš„Staker UIæ ‡ç­¾ï¼Œä½ ä¼šå‘ç°äº‹ä»¶æ¡†å·²ç»è¢«æŠ¹å»äº†ã€‚

### å‰å°ç¼–è¾‘

åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå‰å°çš„è®¸å¤šä»£ç å°†ä¿æŒä¸é»˜è®¤çš„ç›¸åŒ åœ¨å‰é¢çš„æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å·²ç»åˆ é™¤äº†äº‹ä»¶ååº”ç»„ä»¶ã€‚

æˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡æ˜¯è¦æœ‰ä¸€ä¸ªæ¼‚äº®çš„ã€ç®€å•çš„ç”¨æˆ·ç•Œé¢ï¼Œçœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·ã€‚

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/20220823214950.png)

è¯·æ³¨æ„ï¼Œé»˜è®¤çš„å‰å°ç¼ºå°‘ä¸€äº›é»˜è®¤ repo çš„è§†è§‰å…ƒç´ ã€‚

### æ¯ç§’å¥–åŠ±ç‡

ä¸ºäº†æ„å»ºè¿™éƒ¨åˆ†å†…å®¹ï¼Œæˆ‘ä»¬åœ¨StakeråˆåŒå—ä¸‹ç›´æ¥æ’å…¥ä»¥ä¸‹ä»£ç ã€‚

```javascript
  <div style={{ padding: 8, marginTop: 16 }}>
    <div>Reward Rate Per Second:</div>
    <Balance balance={rewardRatePerSecond} fontSize={64} /> ETH
  </div>
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åˆ©ç”¨äº†Scaffold-Ethçš„å¹³è¡¡ååº”ç»„ä»¶æ¥å¸®åŠ©æ ¼å¼åŒ–!

### æœ€åæœŸé™çš„UIå…ƒç´ 

ä¸ºäº†æ„å»ºæˆªæ­¢æ—¥æœŸè§†è§‰ç»„ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä»¥ä¸‹2æ®µä»£ç ã€‚

```javascript
  // ** keep track of a variable from the contract in the local React state:
  const claimPeriodLeft = useContractReader(readContracts, "Staker", "claimPeriodLeft");
  console.log("â³ Claim Period Left:", claimPeriodLeft);

  const withdrawalTimeLeft = useContractReader(readContracts, "Staker", "withdrawalTimeLeft");
  console.log("â³ Withdrawal Time Left:", withdrawalTimeLeft);
```



```html
<div style={{ padding: 8, marginTop: 16, fontWeight: "bold" }}>
  <div>Claim Period Left:</div>
  {claimPeriodLeft && humanizeDuration(claimPeriodLeft.toNumber() * 1000)}
</div>

<div style={{ padding: 8, marginTop: 16, fontWeight: "bold"}}>
  <div>Withdrawal Period Left:</div>
  {withdrawalTimeLeft && humanizeDuration(withdrawalTimeLeft.toNumber() * 1000)}
</div>
```



è™½ç„¶ç¬¬äºŒä¸ªä»£ç ç‰‡æ–­å¾ˆç†Ÿæ‚‰ï¼Œä¸æˆ‘ä»¬å·²ç»çœ‹åˆ°çš„ç›¸ä¼¼ï¼Œä½†ç¬¬ä¸€ä¸ªä»£ç å—æœ‰ç‚¹ç‹¬ç‰¹ã€‚ä¸æ˜¯è¯´æˆ‘ä»¬è°ƒç”¨ `claimPeriodLeft `å’Œ` withdrawalTimeLeft `æ¥è®¿é—®å‰ç«¯çš„å­˜å‚¨å˜é‡å€¼ã€‚

ç„¶è€Œï¼Œæˆ‘ä»¬å®é™…ä¸Šå¿…é¡»å…ˆä»æ™ºèƒ½åˆçº¦ä¸­è¯»å–è¿™äº›å€¼æœ¬èº«ã€‚ç¬¬ä¸€ä¸ªä»£ç ç‰‡æ–­å¤„ç†äº†è¿™ä¸ªé€»è¾‘!

### æ‚é¡¹:å¯¹å…¶ä»–ç°æœ‰çš„UIç»„ä»¶çš„ç¼–è¾‘

ç°åœ¨ä½ å·²ç»çœ‹åˆ°äº†2ä¸ªä¸åŒçš„å‰å°UIç»„ä»¶çš„ä¾‹å­ï¼Œä½ èƒ½æƒ³å‡ºå¦‚ä½•å¯¹å‰å°è¿›è¡Œå…¶ä½™çš„ä¿®æ”¹ï¼Œä½¿å…¶çœ‹èµ·æ¥åƒä¸Šé¢æä¾›çš„æ ·æœ¬å—ï¼ï¼Ÿ

ä½ åº”è¯¥åªéœ€è¦åœ¨è¿™é‡Œè°ƒæ•´ä¸€äº›å‚æ•°ï¼Œæ‰€ä»¥ä¸è¦æƒ³å¾—å¤ªå¤šäº†

### å¯¹ç”¨æˆ·ç•Œé¢çš„è‡ªç”±å‘æŒ¥

è™½ç„¶Scaffold-Ethæœ‰å¾ˆå¤šé»˜è®¤ç»„ä»¶ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿç®€å•åœ°åˆ©ç”¨ "ä½ä»£ç  "è§£å†³æ–¹æ¡ˆï¼Œä½†å®ƒä¹Ÿä½¿ç”¨æˆ·èƒ½å¤Ÿè®¿é—®æ›´å¤§çš„å‰ç«¯åº“ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæœ‰ä¸€ä¸ªä¸Ant Design react componentsï¼ˆhttps://ant.design/components/overview/ï¼‰çš„æŒ‚é’©ï¼Œå…è®¸ä»»ä½•äººä»é‚£é‡Œæå–ç»„ä»¶

åœ¨æˆ‘ä»¬çš„å‰ç«¯æ ·æœ¬ä¸­ï¼Œæˆ‘ä»¬å®é™…ä¸Šçœ‹åˆ°äº† "çº¿ "æ¥åˆ’åˆ†æ¯ä¸ªå¤§å—çš„è§†è§‰ç»„ä»¶ã€‚

é€šè¿‡æ¢ç´¢Ant Designä¸­çš„ä¸åŒé€‰é¡¹ï¼Œå¯ä»¥é‡ç°è¿™äº›çº¿æ¡

> å¦‚æœä½ æƒ³å¾—åˆ°æç¤ºï¼Œè¯·çœ‹ä¸€ä¸‹Ant Dividers!
>
> ä¸è¦å¿˜è®°ï¼Œæˆ‘ä»¬éœ€è¦åœ¨App.jsxæ–‡ä»¶çš„é¡¶éƒ¨å¯¼å…¥æˆ‘ä»¬è®¡åˆ’ä½¿ç”¨çš„ç»„ä»¶
>
> 
>`ä» "antd "å¯¼å…¥ { Alert, Button, Col, Menu, Row, List, Divider }ã€‚`

å¦‚æœä½ å·²ç»è·Ÿä¸Šäº†å‰ç«¯çš„ä»£ç ï¼Œä½ çš„App.jsxåº”è¯¥çœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·ã€‚

```react
import WalletConnectProvider from "@walletconnect/web3-provider";
//import Torus from "@toruslabs/torus-embed"
import WalletLink from "walletlink";
import { Alert, Button, Col, Menu, Row, List, Divider } from "antd";
import "antd/dist/antd.css";
import React, { useCallback, useEffect, useState } from "react";
import { BrowserRouter, Link, Route, Switch } from "react-router-dom";
import Web3Modal from "web3modal";
import "./App.css";
import { Account, Address, Balance, Contract, Faucet, GasGauge, Header, Ramp, ThemeSwitch } from "./components";
import { INFURA_ID, NETWORK, NETWORKS } from "./constants";
import { Transactor } from "./helpers";
import {
  useBalance,
  useContractLoader,
  useContractReader,
  useGasPrice,
  useOnBlock,
  useUserProviderAndSigner,
} from "eth-hooks";
import { useEventListener } from "eth-hooks/events/useEventListener";
import { useExchangeEthPrice } from "eth-hooks/dapps/dex";
// import Hints from "./Hints";
import { ExampleUI, Hints, Subgraph } from "./views";

import { useContractConfig } from "./hooks";
import Portis from "@portis/web3";
import Fortmatic from "fortmatic";
import Authereum from "authereum";
import humanizeDuration from "humanize-duration";

const { ethers } = require("ethers");
/*
    Welcome to ğŸ— scaffold-eth !

    Code:
    https://github.com/austintgriffith/scaffold-eth

    Support:
    https://t.me/joinchat/KByvmRe5wkR-8F_zz6AjpA
    or DM @austingriffith on Twitter or Telegram

    You should get your own Infura.io ID and put it in `constants.js`
    (this is your connection to the main Ethereum network for ENS etc.)


    ğŸŒ EXTERNAL CONTRACTS:
    You can also bring in contract artifacts in `constants.js`
    (and then use the `useExternalContractLoader()` hook!)
*/

/// ğŸ“¡ What chain are your contracts deployed to?
const targetNetwork = NETWORKS.localhost; // <------- select your target frontend network (localhost, rinkeby, xdai, mainnet)

// ğŸ˜¬ Sorry for all the console logging
const DEBUG = true;
const NETWORKCHECK = true;

// ğŸ›° providers
if (DEBUG) console.log("ğŸ“¡ Connecting to Mainnet Ethereum");
// const mainnetProvider = getDefaultProvider("mainnet", { infura: INFURA_ID, etherscan: ETHERSCAN_KEY, quorum: 1 });
// const mainnetProvider = new InfuraProvider("mainnet",INFURA_ID);
//
// attempt to connect to our own scaffold eth rpc and if that fails fall back to infura...
// Using StaticJsonRpcProvider as the chainId won't change see https://github.com/ethers-io/ethers.js/issues/901
const scaffoldEthProvider = navigator.onLine
  ? new ethers.providers.StaticJsonRpcProvider("https://rpc.scaffoldeth.io:48544")
  : null;
const poktMainnetProvider = navigator.onLine
  ? new ethers.providers.StaticJsonRpcProvider(
      "https://eth-mainnet.gateway.pokt.network/v1/lb/611156b4a585a20035148406",
    )
  : null;
const mainnetInfura = navigator.onLine
  ? new ethers.providers.StaticJsonRpcProvider("https://mainnet.infura.io/v3/" + INFURA_ID)
  : null;
// ( âš ï¸ Getting "failed to meet quorum" errors? Check your INFURA_ID

// ğŸ  Your local provider is usually pointed at your local blockchain
const localProviderUrl = targetNetwork.rpcUrl;
// as you deploy to other networks you can set REACT_APP_PROVIDER=https://dai.poa.network in packages/react-app/.env
const localProviderUrlFromEnv = process.env.REACT_APP_PROVIDER ? process.env.REACT_APP_PROVIDER : localProviderUrl;
if (DEBUG) console.log("ğŸ  Connecting to provider:", localProviderUrlFromEnv);
const localProvider = new ethers.providers.StaticJsonRpcProvider(localProviderUrlFromEnv);

// ğŸ”­ block explorer URL
const blockExplorer = targetNetwork.blockExplorer;

// Coinbase walletLink init
const walletLink = new WalletLink({
  appName: "coinbase",
});

// WalletLink provider
const walletLinkProvider = walletLink.makeWeb3Provider(`https://mainnet.infura.io/v3/${INFURA_ID}`, 1);

// Portis ID: 6255fb2b-58c8-433b-a2c9-62098c05ddc9
/*
  Web3 modal helps us "connect" external wallets:
*/
const web3Modal = new Web3Modal({
  network: "mainnet", // Optional. If using WalletConnect on xDai, change network to "xdai" and add RPC info below for xDai chain.
  cacheProvider: true, // optional
  theme: "light", // optional. Change to "dark" for a dark theme.
  providerOptions: {
    walletconnect: {
      package: WalletConnectProvider, // required
      options: {
        bridge: "https://polygon.bridge.walletconnect.org",
        infuraId: INFURA_ID,
        rpc: {
          1: `https://mainnet.infura.io/v3/${INFURA_ID}`, // mainnet // For more WalletConnect providers: https://docs.walletconnect.org/quick-start/dapps/web3-provider#required
          42: `https://kovan.infura.io/v3/${INFURA_ID}`,
          100: "https://dai.poa.network", // xDai
        },
      },
    },
    portis: {
      display: {
        logo: "https://user-images.githubusercontent.com/9419140/128913641-d025bc0c-e059-42de-a57b-422f196867ce.png",
        name: "Portis",
        description: "Connect to Portis App",
      },
      package: Portis,
      options: {
        id: "6255fb2b-58c8-433b-a2c9-62098c05ddc9",
      },
    },
    fortmatic: {
      package: Fortmatic, // required
      options: {
        key: "pk_live_5A7C91B2FC585A17", // required
      },
    },
    // torus: {
    //   package: Torus,
    //   options: {
    //     networkParams: {
    //       host: "https://localhost:8545", // optional
    //       chainId: 1337, // optional
    //       networkId: 1337 // optional
    //     },
    //     config: {
    //       buildEnv: "development" // optional
    //     },
    //   },
    // },
    "custom-walletlink": {
      display: {
        logo: "https://play-lh.googleusercontent.com/PjoJoG27miSglVBXoXrxBSLveV6e3EeBPpNY55aiUUBM9Q1RCETKCOqdOkX2ZydqVf0",
        name: "Coinbase",
        description: "Connect to Coinbase Wallet (not Coinbase App)",
      },
      package: walletLinkProvider,
      connector: async (provider, _options) => {
        await provider.enable();
        return provider;
      },
    },
    authereum: {
      package: Authereum, // required
    },
  },
});

function App(props) {
  const mainnetProvider =
    poktMainnetProvider && poktMainnetProvider._isProvider
      ? poktMainnetProvider
      : scaffoldEthProvider && scaffoldEthProvider._network
      ? scaffoldEthProvider
      : mainnetInfura;

  const [injectedProvider, setInjectedProvider] = useState();
  const [address, setAddress] = useState();

  const logoutOfWeb3Modal = async () => {
    await web3Modal.clearCachedProvider();
    if (injectedProvider && injectedProvider.provider && typeof injectedProvider.provider.disconnect == "function") {
      await injectedProvider.provider.disconnect();
    }
    setTimeout(() => {
      window.location.reload();
    }, 1);
  };

  /* ğŸ’µ This hook will get the price of ETH from ğŸ¦„ Uniswap: */
  const price = useExchangeEthPrice(targetNetwork, mainnetProvider);

  /* ğŸ”¥ This hook will get the price of Gas from â›½ï¸ EtherGasStation */
  const gasPrice = useGasPrice(targetNetwork, "fast");
  // Use your injected provider from ğŸ¦Š Metamask or if you don't have it then instantly generate a ğŸ”¥ burner wallet.
  const userProviderAndSigner = useUserProviderAndSigner(injectedProvider, localProvider);
  const userSigner = userProviderAndSigner.signer;

  useEffect(() => {
    async function getAddress() {
      if (userSigner) {
        const newAddress = await userSigner.getAddress();
        setAddress(newAddress);
      }
    }
    getAddress();
  }, [userSigner]);

  // You can warn the user if you would like them to be on a specific network
  const localChainId = localProvider && localProvider._network && localProvider._network.chainId;
  const selectedChainId =
    userSigner && userSigner.provider && userSigner.provider._network && userSigner.provider._network.chainId;

  // For more hooks, check out ğŸ”—eth-hooks at: https://www.npmjs.com/package/eth-hooks

  // The transactor wraps transactions and provides notificiations
  const tx = Transactor(userSigner, gasPrice);

  // Faucet Tx can be used to send funds from the faucet
  const faucetTx = Transactor(localProvider, gasPrice);

  // ğŸ— scaffold-eth is full of handy hooks like this one to get your balance:
  const yourLocalBalance = useBalance(localProvider, address);

  // Just plug in different ğŸ›° providers to get your balance on different chains:
  const yourMainnetBalance = useBalance(mainnetProvider, address);

  const contractConfig = useContractConfig();

  // Load in your local ğŸ“ contract and read a value from it:
  const readContracts = useContractLoader(localProvider, contractConfig);

  // If you want to make ğŸ” write transactions to your contracts, use the userSigner:
  const writeContracts = useContractLoader(userSigner, contractConfig, localChainId);

  // EXTERNAL CONTRACT EXAMPLE:
  //
  // If you want to bring in the mainnet DAI contract it would look like:
  const mainnetContracts = useContractLoader(mainnetProvider, contractConfig);

  // If you want to call a function on a new block
  useOnBlock(mainnetProvider, () => {
    console.log(`â›“ A new mainnet block is here: ${mainnetProvider._lastBlockNumber}`);
  });

  // Then read your DAI balance like:
  const myMainnetDAIBalance = useContractReader(mainnetContracts, "DAI", "balanceOf", [
    "0x34aA3F359A9D614239015126635CE7732c18fDF3",
  ]);

  //keep track of contract balance to know how much has been staked total:
  const stakerContractBalance = useBalance(
    localProvider,
    readContracts && readContracts.Staker ? readContracts.Staker.address : null,
  );
  if (DEBUG) console.log("ğŸ’µ stakerContractBalance", stakerContractBalance);

  const rewardRatePerSecond = useContractReader(readContracts, "Staker", "rewardRatePerSecond");
  console.log("ğŸ’µ Reward Rate:", rewardRatePerSecond);

  // ** keep track of a variable from the contract in the local React state:
  const balanceStaked = useContractReader(readContracts, "Staker", "balances", [address]);
  console.log("ğŸ’¸ balanceStaked:", balanceStaked);

  // ** ğŸ“Ÿ Listen for broadcast events
  const stakeEvents = useEventListener(readContracts, "Staker", "Stake", localProvider, 1);
  console.log("ğŸ“Ÿ stake events:", stakeEvents);

  const receiveEvents = useEventListener(readContracts, "Staker", "Received", localProvider, 1);
  console.log("ğŸ“Ÿ receive events:", receiveEvents);

  // ** keep track of a variable from the contract in the local React state:
  const claimPeriodLeft = useContractReader(readContracts, "Staker", "claimPeriodLeft");
  console.log("â³ Claim Period Left:", claimPeriodLeft);

  const withdrawalTimeLeft = useContractReader(readContracts, "Staker", "withdrawalTimeLeft");
  console.log("â³ Withdrawal Time Left:", withdrawalTimeLeft);


  // ** Listen for when the contract has been 'completed'
  const complete = useContractReader(readContracts, "ExampleExternalContract", "completed");
  console.log("âœ… complete:", complete);

  const exampleExternalContractBalance = useBalance(
    localProvider,
    readContracts && readContracts.ExampleExternalContract ? readContracts.ExampleExternalContract.address : null,
  );
  if (DEBUG) console.log("ğŸ’µ exampleExternalContractBalance", exampleExternalContractBalance);

  let completeDisplay = "";
  if (complete) {
    completeDisplay = (
      <div style={{padding: 64, backgroundColor: "#eeffef", fontWeight: "bold", color: "rgba(0, 0, 0, 0.85)" }} >
        -- ğŸ’€ Staking App Fund Repatriation Executed ğŸª¦ --
        <Balance balance={exampleExternalContractBalance} fontSize={32} /> ETH locked!
      </div>
    );
  }

  /*
  const addressFromENS = useResolveName(mainnetProvider, "austingriffith.eth");
  console.log("ğŸ· Resolved austingriffith.eth as:", addressFromENS)
  */

  //
  // ğŸ§« DEBUG ğŸ‘¨ğŸ»â€ğŸ”¬
  //
  useEffect(() => {
    if (
      DEBUG &&
      mainnetProvider &&
      address &&
      selectedChainId &&
      yourLocalBalance &&
      yourMainnetBalance &&
      readContracts &&
      writeContracts &&
      mainnetContracts
    ) {
      console.log("_____________________________________ ğŸ— scaffold-eth _____________________________________");
      console.log("ğŸŒ mainnetProvider", mainnetProvider);
      console.log("ğŸ  localChainId", localChainId);
      console.log("ğŸ‘©â€ğŸ’¼ selected address:", address);
      console.log("ğŸ•µğŸ»â€â™‚ï¸ selectedChainId:", selectedChainId);
      console.log("ğŸ’µ yourLocalBalance", yourLocalBalance ? ethers.utils.formatEther(yourLocalBalance) : "...");
      console.log("ğŸ’µ yourMainnetBalance", yourMainnetBalance ? ethers.utils.formatEther(yourMainnetBalance) : "...");
      console.log("ğŸ“ readContracts", readContracts);
      console.log("ğŸŒ DAI contract on mainnet:", mainnetContracts);
      console.log("ğŸ’µ yourMainnetDAIBalance", myMainnetDAIBalance);
      console.log("ğŸ” writeContracts", writeContracts);
    }
  }, [
    mainnetProvider,
    address,
    selectedChainId,
    yourLocalBalance,
    yourMainnetBalance,
    readContracts,
    writeContracts,
    mainnetContracts,
  ]);

  let networkDisplay = "";
  if (NETWORKCHECK && localChainId && selectedChainId && localChainId !== selectedChainId) {
    const networkSelected = NETWORK(selectedChainId);
    const networkLocal = NETWORK(localChainId);
    if (selectedChainId === 1337 && localChainId === 31337) {
      networkDisplay = (
        <div style={{ zIndex: 2, position: "absolute", right: 0, top: 60, padding: 16 }}>
          <Alert
            message="âš ï¸ Wrong Network ID"
            description={
              <div>
                You have <b>chain id 1337</b> for localhost and you need to change it to <b>31337</b> to work with
                HardHat.
                <div>(MetaMask -&gt; Settings -&gt; Networks -&gt; Chain ID -&gt; 31337)</div>
              </div>
            }
            type="error"
            closable={false}
          />
        </div>
      );
    } else {
      networkDisplay = (
        <div style={{ zIndex: 2, position: "absolute", right: 0, top: 60, padding: 16 }}>
          <Alert
            message="âš ï¸ Wrong Network"
            description={
              <div>
                You have <b>{networkSelected && networkSelected.name}</b> selected and you need to be on{" "}
                <Button
                  onClick={async () => {
                    const ethereum = window.ethereum;
                    const data = [
                      {
                        chainId: "0x" + targetNetwork.chainId.toString(16),
                        chainName: targetNetwork.name,
                        nativeCurrency: targetNetwork.nativeCurrency,
                        rpcUrls: [targetNetwork.rpcUrl],
                        blockExplorerUrls: [targetNetwork.blockExplorer],
                      },
                    ];
                    console.log("data", data);

                    let switchTx;
                    // https://docs.metamask.io/guide/rpc-api.html#other-rpc-methods
                    try {
                      switchTx = await ethereum.request({
                        method: "wallet_switchEthereumChain",
                        params: [{ chainId: data[0].chainId }],
                      });
                    } catch (switchError) {
                      // not checking specific error code, because maybe we're not using MetaMask
                      try {
                        switchTx = await ethereum.request({
                          method: "wallet_addEthereumChain",
                          params: data,
                        });
                      } catch (addError) {
                        // handle "add" error
                      }
                    }

                    if (switchTx) {
                      console.log(switchTx);
                    }
                  }}
                >
                  <b>{networkLocal && networkLocal.name}</b>
                </Button>
              </div>
            }
            type="error"
            closable={false}
          />
        </div>
      );
    }
  } else {
    networkDisplay = (
      <div style={{ zIndex: -1, position: "absolute", right: 154, top: 28, padding: 16, color: targetNetwork.color }}>
        {targetNetwork.name}
      </div>
    );
  }

  const loadWeb3Modal = useCallback(async () => {
    const provider = await web3Modal.connect();
    setInjectedProvider(new ethers.providers.Web3Provider(provider));

    provider.on("chainChanged", chainId => {
      console.log(`chain changed to ${chainId}! updating providers`);
      setInjectedProvider(new ethers.providers.Web3Provider(provider));
    });

    provider.on("accountsChanged", () => {
      console.log(`account changed!`);
      setInjectedProvider(new ethers.providers.Web3Provider(provider));
    });

    // Subscribe to session disconnection
    provider.on("disconnect", (code, reason) => {
      console.log(code, reason);
      logoutOfWeb3Modal();
    });
  }, [setInjectedProvider]);

  useEffect(() => {
    if (web3Modal.cachedProvider) {
      loadWeb3Modal();
    }
  }, [loadWeb3Modal]);

  const [route, setRoute] = useState();
  useEffect(() => {
    setRoute(window.location.pathname);
  }, [setRoute]);

  let faucetHint = "";
  const faucetAvailable = localProvider && localProvider.connection && targetNetwork.name.indexOf("local") !== -1;

  const [faucetClicked, setFaucetClicked] = useState(false);
  if (
    !faucetClicked &&
    localProvider &&
    localProvider._network &&
    localProvider._network.chainId === 31337 &&
    yourLocalBalance &&
    ethers.utils.formatEther(yourLocalBalance) <= 0
  ) {
    faucetHint = (
      <div style={{ padding: 16 }}>
        <Button
          type="primary"
          onClick={() => {
            faucetTx({
              to: address,
              value: ethers.utils.parseEther("0.01"),
            });
            setFaucetClicked(true);
          }}
        >
          ğŸ’° Grab funds from the faucet â›½ï¸
        </Button>
      </div>
    );
  }

  return (
    <div className="App">
      {/* âœï¸ Edit the header and change the title to your project name */}
      <Header />
      {networkDisplay}
      <BrowserRouter>
        <Menu style={{ textAlign: "center" }} selectedKeys={[route]} mode="horizontal">
          <Menu.Item key="/">
            <Link
              onClick={() => {
                setRoute("/");
              }}
              to="/"
            >
              Staker UI
            </Link>
          </Menu.Item>
          <Menu.Item key="/contracts">
            <Link
              onClick={() => {
                setRoute("/contracts");
              }}
              to="/contracts"
            >
              Debug Contracts
            </Link>
          </Menu.Item>
        </Menu>

        <Switch>
          <Route exact path="/">
            {completeDisplay}

            <div style={{ padding: 8, marginTop: 16 }}>
              <div>Staker Contract:</div>
              <Address value={readContracts && readContracts.Staker && readContracts.Staker.address} />
            </div>

            <Divider />

            <div style={{ padding: 8, marginTop: 16 }}>
              <div>Reward Rate Per Second:</div>
              <Balance balance={rewardRatePerSecond} fontSize={64} /> ETH
            </div>

            <Divider />

            <div style={{ padding: 8, marginTop: 16, fontWeight: "bold" }}>
              <div>Claim Period Left:</div>
              {claimPeriodLeft && humanizeDuration(claimPeriodLeft.toNumber() * 1000)}
            </div>

            <div style={{ padding: 8, marginTop: 16, fontWeight: "bold"}}>
              <div>Withdrawal Period Left:</div>
              {withdrawalTimeLeft && humanizeDuration(withdrawalTimeLeft.toNumber() * 1000)}
            </div>

            <Divider />

            <div style={{ padding: 8, fontWeight: "bold"}}>
              <div>Total Available ETH in Contract:</div>
              <Balance balance={stakerContractBalance} fontSize={64} />
            </div>

            <Divider />

            <div style={{ padding: 8,fontWeight: "bold" }}>
              <div>ETH Locked ğŸ”’ in Staker Contract:</div>
              <Balance balance={balanceStaked} fontSize={64} />
            </div>

            <div style={{ padding: 8 }}>
              <Button
                type={"default"}
                onClick={() => {
                  tx(writeContracts.Staker.execute());
                }}
              >
                ğŸ“¡ Execute!
              </Button>
            </div>

            <div style={{ padding: 8 }}>
              <Button
                type={"default"}
                onClick={() => {
                  tx(writeContracts.Staker.withdraw());
                }}
              >
                ğŸ§ Withdraw
              </Button>
            </div>

            <div style={{ padding: 8 }}>
              <Button
                type={balanceStaked ? "success" : "primary"}
                onClick={() => {
                  tx(writeContracts.Staker.stake({ value: ethers.utils.parseEther("0.5") }));
                }}
              >
                ğŸ¥© Stake 0.5 ether!
              </Button>
            </div>

            {/*
                ğŸ› this scaffolding is full of commonly used components
                this <Contract/> component will automatically parse your ABI
                and give you a form to interact with it locally
            */}

            {/* uncomment for a second contract:
            <Contract
              name="SecondContract"
              signer={userProvider.getSigner()}
              provider={localProvider}
              address={address}
              blockExplorer={blockExplorer}
              contractConfig={contractConfig}
            />
            */}
          </Route>
          <Route path="/contracts">
            <Contract
              name="Staker"
              signer={userSigner}
              provider={localProvider}
              address={address}
              blockExplorer={blockExplorer}
              contractConfig={contractConfig}
            />
            <Contract
              name="ExampleExternalContract"
              signer={userSigner}
              provider={localProvider}
              address={address}
              blockExplorer={blockExplorer}
              contractConfig={contractConfig}
            />
          </Route>
        </Switch>
      </BrowserRouter>

      <ThemeSwitch />

      {/* ğŸ‘¨â€ğŸ’¼ Your account is in the top right with a wallet at connect options */}
      <div style={{ position: "fixed", textAlign: "right", right: 0, top: 0, padding: 10 }}>
        <Account
          address={address}
          localProvider={localProvider}
          userSigner={userSigner}
          mainnetProvider={mainnetProvider}
          price={price}
          web3Modal={web3Modal}
          loadWeb3Modal={loadWeb3Modal}
          logoutOfWeb3Modal={logoutOfWeb3Modal}
          blockExplorer={blockExplorer}
        />
        {faucetHint}
      </div>

      <div style={{ marginTop: 32, opacity: 0.5 }}>
        {/* Add your address here */}
        Created by <Address value={"Your...address"} ensProvider={mainnetProvider} fontSize={16} />
      </div>

      <div style={{ marginTop: 32, opacity: 0.5 }}>
        <a target="_blank" style={{ padding: 32, color: "#000" }} href="https://github.com/scaffold-eth/scaffold-eth">
          ğŸ´ Fork me!
        </a>
      </div>

      {/* ğŸ—º Extra UI like gas price, eth price, faucet, and support: */}
      <div style={{ position: "fixed", textAlign: "left", left: 0, bottom: 20, padding: 10 }}>
        <Row align="middle" gutter={[4, 4]}>
          <Col span={8}>
            <Ramp price={price} address={address} networks={NETWORKS} />
          </Col>

          <Col span={8} style={{ textAlign: "center", opacity: 0.8 }}>
            <GasGauge gasPrice={gasPrice} />
          </Col>
          <Col span={8} style={{ textAlign: "center", opacity: 1 }}>
            <Button
              onClick={() => {
                window.open("https://t.me/joinchat/KByvmRe5wkR-8F_zz6AjpA");
              }}
              size="large"
              shape="round"
            >
              <span style={{ marginRight: 8 }} role="img" aria-label="support">
                ğŸ’¬
              </span>
              Support
            </Button>
          </Col>
        </Row>

        <Row align="middle" gutter={[4, 4]}>
          <Col span={24}>
            {
              /*  if the local provider has a signer, let's show the faucet:  */
              faucetAvailable ? (
                <Faucet localProvider={localProvider} price={price} ensProvider={mainnetProvider} />
              ) : (
                ""
              )
            }
          </Col>
        </Row>
      </div>
    </div>
  );
}

export default App;

```



çœŸæ£’ï¼æˆ‘ä»¬å·²ç»åšäº†å¾ˆå¤šå·¥ä½œã€‚

åœ¨å¼€å‘è€…ç¯å¢ƒã€Solidityå’Œå‰ç«¯ä»£ç æ–¹é¢ï¼Œæˆ‘ä»¬å·²ç»ä¸€èµ·å®Œæˆäº†å¾ˆå¤šæ–°çš„ç»„ä»¶ã€‚

éªŒè¯æ‚¨çš„dAppçš„åŠŸèƒ½æ˜¯å¦ç¬¦åˆé¢„æœŸ!

1. dAppæ˜¯å¦å…·æœ‰å•æ¬¡ä½¿ç”¨æŠ¼é‡‘çš„åŠŸèƒ½ï¼Ÿ
2. ææ¬¾/èµ„é‡‘è¿”è¿˜æ¡ä»¶æ˜¯å¦å¾—åˆ°å°Šé‡ï¼Ÿç»§ç»­ç‚¹å‡»`yarn deploy --reset`å‡ æ¬¡ï¼Œæ£€æŸ¥æ¯ä¸ªæ—¶é—´çª—å£ã€‚

## æŒ‘æˆ˜æ—¶é—´!

å¥½äº†ï¼Œç°åœ¨åˆ°äº†æœ€ç²¾å½©çš„éƒ¨åˆ†ã€‚æˆ‘å°†ç•™ç»™ä½ ä¸€äº›æ‰©å±•æŒ‘æˆ˜ï¼Œè®©ä½ è‡ªå·±å»å°è¯•ï¼Œçœ‹çœ‹ä½ æ˜¯å¦å®Œå…¨ç†è§£äº†ä½ åœ¨è¿™é‡Œå­¦åˆ°çš„ä¸œè¥¿!

1. æ›´æ–°`Staker.sol`åˆçº¦ä¸­çš„åˆ©æ¯æœºåˆ¶ï¼Œè¿™æ ·ä½ å°±å¯ä»¥æ ¹æ®å­˜æ¬¾å’Œææ¬¾ä¹‹é—´çš„åŒºå—è·å¾— "éçº¿æ€§ "çš„ETHæ•°é¢

> æˆ‘å»ºè®®å®ç°ä¸€ä¸ªåŸºæœ¬çš„æŒ‡æ•°å‡½æ•°!

2. å…è®¸ç”¨æˆ·å‘æ™ºèƒ½åˆçº¦å­˜å…¥ä»»æ„æ•°é‡çš„ETHï¼Œè€Œä¸ä»…ä»…æ˜¯0.5ETHã€‚

3. ä¸è¦ä½¿ç”¨vanilla `ExampleExternalContract`åˆçº¦ï¼Œåœ¨Staker.solä¸­å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œå…è®¸ä½ å–å›é”å®šåœ¨`ExampleExternalContract`ä¸­çš„ETHï¼Œå¹¶å°†å…¶é‡æ–°å­˜å…¥Stakeråˆçº¦ä¸­ã€‚

- è¯·ç¡®ä¿åªæœ‰ "ç™½åå• "ä¸­çš„ä¸€ä¸ªåœ°å€å¯ä»¥è°ƒç”¨è¿™ä¸ªæ–°å‡½æ•°ï¼Œä»¥æ§åˆ¶å…¶ä½¿ç”¨ã€‚
- ç¡®ä¿ä½ åˆ›å»ºäº†é€»è¾‘/åˆ é™¤äº†ç°æœ‰çš„ä»£ç ï¼Œä»¥ç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿä¸€æ¬¡åˆä¸€æ¬¡åœ°ä¸StakeråˆåŒäº’åŠ¨ æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåå¤åœ°ä»`Staker` ->` ExampleExternalContract`è¿›è¡Œping-pongã€‚

![](https://hicoldcat.oss-cn-hangzhou.aliyuncs.com/img/my.png)
